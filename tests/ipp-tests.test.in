#
# IPP Everywhere Printer Self-Certification Manual 1.1: Section 6: IPP Tests.
#
# Copyright 2014-2020 by the IEEE-ISTO Printer Working Group.
# Copyright 2007-2019 by Apple Inc.
# Copyright 2001-2006 by Easy Software Products. All rights reserved.
#
# Licensed under Apache License v2.0.  See the file "LICENSE" for more
# information.
#
# Usage:
#
#   ./ipptool -tI printer-uri ipp-tests.test
#
# History:
#
# This test file is loosely based on the IPP/1.1, IPP/2.0 and IPP Everywhere
# test files from the CUPS "examples" directory.  Many of those tests have been
# combined or removed, and all print tests are performed using a sample PWG
# Raster file.  These tests also validate support for the 'media-needed' keyword
# in the "printer-state-reasons" Printer attribute.
#

FILE-ID "org.pwg.@IPPEVESELFCERT_VERSION@.ipp"

# All tests use IPP version 2.0, unless overridden in a test...
VERSION 2.0

# Regular expressions for URI schemes:
#
#   HTTP_URI_SCHEME - Matches strings beginning with http:// or https://
#   IPP_URI_SCHEME  - Matches strings beginning with ipp:// or ipps://
#   UUID_URI        - Matches UUID URN strings.

DEFINE HTTP_URI_SCHEME "/^https?://.+$$/"
DEFINE IPP_URI_SCHEME "/^ipps?://.+$$/"
DEFINE LINK_LOCAL "/^(\[|\[v1.)fe80:/"
DEFINE UUID_URI "/^urn:uuid:[0-9A-Fa-f]{8,8}-[0-9A-Fa-f]{4,4}-[0-9A-Fa-f]{4,4}-[0-9A-Fa-f]{4,4}-[0-9A-Fa-f]{12,12}/"

# Regular expression for PWG media size names (eek!)
#
# Generated with help from: http://abnf.msweet.org/
DEFINE MEDIA_REGEX "/^(choice(_((custom|na|asme|roc|oe|roll)_[a-z0-9][-a-z0-9]*_([1-9][0-9]*(\.[0-9]*[1-9])?|0\.[0-9]*[1-9])x([1-9][0-9]*(\.[0-9]*[1-9])?|0\.[0-9]*[1-9])in|(custom|iso|jis|jpn|prc|om|roll)_[a-z0-9][-a-z0-9]*_([1-9][0-9]*(\.[0-9]*[1-9])?|0\.[0-9]*[1-9])x([1-9][0-9]*(\.[0-9]*[1-9])?|0\.[0-9]*[1-9])mm)){2,}|(custom|na|asme|roc|oe|roll)_[a-z0-9][-a-z0-9]*_([1-9][0-9]*(\.[0-9]*[1-9])?|0\.[0-9]*[1-9])x([1-9][0-9]*(\.[0-9]*[1-9])?|0\.[0-9]*[1-9])in|(custom|iso|jis|jpn|prc|om|roll)_[a-z0-9][-a-z0-9]*_([1-9][0-9]*(\.[0-9]*[1-9])?|0\.[0-9]*[1-9])x([1-9][0-9]*(\.[0-9]*[1-9])?|0\.[0-9]*[1-9])mm)$$/"

# Regular expression for printer-alert attribute
#
# Generated with help from: http://abnf.msweet.org/
DEFINE ALERT_REGEX "/^code\=[A-Za-z]+(;index\=[0-9]+|;severity\=[A-Za-z]+|;training\=[A-Za-z]+|;group\=[A-Za-z]+|;groupindex\=[0-9]+|;location\=[0-9]+|;time\=[0-9]+){0,};?$$/"

# Regular expression for printer-supply attribute
#
# Generated with help from: http://abnf.msweet.org/
DEFINE SUPPLY_REGEX "/^(type\=[A-Za-z]+;|maxcapacity\=-{0,1}[0-9]+;|level\=-{0,1}[0-9]+;|index\=[0-9]+;|markerindex\=[0-9]+;|class\=[A-Za-z]+;|unit\=[A-Za-z]+;|colorantindex\=[0-9]+;|colorantrole\=[A-Za-z]+;|colorantname\=[-_.A-Za-z0-9]+;|coloranttonality\=[0-9]+;){0,}$$/"

# Test that a request-id value of 0 is not accepted.
#
# Required by: RFC 8011 section 4.1.1
{
	NAME "I-1. RFC 8011 section 4.1.1: Bad request-id value 0"
	REQUEST-ID 0
	OPERATION Get-Printer-Attributes
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri

	STATUS client-error-bad-request
	EXPECT !printer-uri-supported
}


# Test that the first two attributes must be attributes-charset and
# attributes-natural-language.
#
# Required by: RFC 8011 section 4.1.4
{
	NAME "I-2. RFC 8011 section 4.1.4: No Operation Attributes"
	REQUEST-ID random
	OPERATION Get-Printer-Attributes
	GROUP operation-attributes-tag

	STATUS client-error-bad-request
	EXPECT !printer-uri-supported
}
{
	NAME "I-3. RFC 8011 section 4.1.4: attributes-charset"
	OPERATION Get-Printer-Attributes
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR uri printer-uri $uri

	STATUS client-error-bad-request
	EXPECT !printer-uri-supported
}
{
	NAME "I-4. RFC 8011 section 4.1.4: attributes-natural-language"
	OPERATION Get-Printer-Attributes
	GROUP operation-attributes-tag
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri

	STATUS client-error-bad-request
	EXPECT !printer-uri-supported
}
{
	NAME "I-5. RFC 8011 section 4.1.4: attributes-natural-language + attributes-charset"
	OPERATION Get-Printer-Attributes
	GROUP operation-attributes-tag
	ATTR naturalLanguage attributes-natural-language en
	ATTR charset attributes-charset utf-8
	ATTR uri printer-uri $uri

	STATUS client-error-bad-request
	EXPECT !printer-uri-supported
}
{
	NAME "I-6. RFC 8011 section 4.1.4: attributes-charset + attributes-natural-language"
	OPERATION Get-Printer-Attributes
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri

	STATUS successful-ok
	EXPECT printer-uri-supported OF-TYPE uri WITH-ALL-VALUES "$IPP_URI_SCHEME"
	EXPECT operations-supported WITH-VALUE 0x003c # Identify-Printer
		DEFINE-MATCH HAVE_IDENTIFY_PRINTER
}


# Test that bad IPP versions are not supported.
#
# Required by: RFC 8011 section 4.1.8
{
	# The name of the test...
	NAME "I-7. RFC 8011 section 4.1.8: Unsupported IPP version 0.0"
	VERSION 0.0
	OPERATION Get-Printer-Attributes
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri

	STATUS server-error-version-not-supported
	EXPECT !printer-uri-supported
}


# Test that printer operations require the printer-uri operation attribute.
#
# Required by: RFC 8011 section 4.2
{
	NAME "I-8. RFC 8011 section 4.2: No printer-uri operation attribute"
	OPERATION Get-Printer-Attributes
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en

	STATUS client-error-bad-request
	EXPECT !printer-uri-supported
}


#
# Check for Identify-Printer support
#
# Required by: PWG 5100.14 Section 5.x
{
	NAME "I-9.1 Get-Printer-Attributes (check for Identify-Printer support)"

	OPERATION Get-Printer-Attributes

	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR language attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR keyword requested-attributes 'operations-supported','identify-actions-supported','identify-actions-default'

	STATUS successful-ok

	EXPECT operations-supported WITH-VALUE 0x003c # Identify-Printer
		IF-NOT-DEFINED IPP_EVERYWHERE_SERVER DEFINE-MATCH HAVE_IDENTIFY_PRINTER
        
	EXPECT identify-actions-supported OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-VALUE "/^(display|flash|sound|speak)$/" IF-DEFINED HAVE_IDENTIFY_PRINTER
	EXPECT identify-actions-default OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-VALUE-FROM identify-actions-supported IF-DEFINED HAVE_IDENTIFY_PRINTER
	EXPECT identify-actions-default OF-TYPE keyword IN-GROUP printer-attributes-tag DEFINE-VALUE IDENTIFY_ACTION_DEFAULT IF-DEFINED HAVE_IDENTIFY_PRINTER
}


#
# Test Identify-Printer operation if supported
#
# Required by: PWG 5100.14 Section 5.x
{
	SKIP-IF-NOT-DEFINED HAVE_IDENTIFY_PRINTER

	NAME "I-9.2 Identify-Printer (identify-action $IDENTIFY_ACTION_DEFAULT)"
	OPERATION Identify-Printer
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
    ATTR keyword identify-actions $IDENTIFY_ACTION_DEFAULT
    ATTR text message "ipp-tests.test: $user testing Identify Printer"

	STATUS successful-ok
}



# Test Get-Printer-Attributes operation
#
# Required by: PWG 5100.14 Section 5.x
{
	NAME "I-10. Get-Printer-Attributes Operation (default)"
	OPERATION Get-Printer-Attributes
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user

	STATUS successful-ok

	# ipp-features-supported
	EXPECT ipp-features-supported OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-VALUE "ipp-everywhere"
	EXPECT ipp-features-supported WITH-VALUE "ipp-everywhere-server" DEFINE-MATCH IPP_EVERYWHERE_SERVER

	##### PWG 5100.14 - Table 5 - Operations
	EXPECT operations-supported OF-TYPE enum IN-GROUP printer-attributes-tag WITH-VALUE 0x0002 # Print-Job
	EXPECT operations-supported WITH-VALUE 0x0004 # Validate-Job
	EXPECT operations-supported WITH-VALUE 0x0005 # Create-Job
	EXPECT operations-supported WITH-VALUE 0x0006 # Send-Document
	EXPECT operations-supported WITH-VALUE 0x0008 # Cancel-Job
	EXPECT operations-supported WITH-VALUE 0x0009 # Get-Job-Attributes
	EXPECT operations-supported WITH-VALUE 0x000a # Get-Jobs
	EXPECT operations-supported WITH-VALUE 0x000b # Get-Printer-Attributes
	EXPECT operations-supported WITH-VALUE 0x0039 # Cancel-My-Jobs
	EXPECT operations-supported WITH-VALUE 0x003b # Close-Job
	EXPECT operations-supported WITH-VALUE 0x003c # Identify-Printer
		IF-NOT-DEFINED IPP_EVERYWHERE_SERVER

	# Default Get-Printer-Attributes MUST NOT return media-col-database, per PWG 5100.7 (JOBEXT)
	EXPECT !media-col-database OF-TYPE collection IN-GROUP printer-attributes-tag

	#### PWG 5100.14 - Table 6 - Printer Description Attributes that are part of the 'printer-description' group
	EXPECT charset-configured OF-TYPE charset IN-GROUP printer-attributes-tag COUNT 1

	EXPECT charset-supported OF-TYPE charset IN-GROUP printer-attributes-tag WITH-VALUE utf-8

	EXPECT color-supported OF-TYPE boolean IN-GROUP printer-attributes-tag COUNT 1
	EXPECT color-supported WITH-VALUE true DEFINE-MATCH HAVE_COLOR

	EXPECT compression-supported OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-VALUE "none"
	EXPECT compression-supported OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-VALUE "deflate" DEFINE-MATCH HAVE_DEFLATE
	EXPECT compression-supported OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-VALUE "gzip" DEFINE-MATCH HAVE_GZIP

	EXPECT document-format-default OF-TYPE mimeMediaType IN-GROUP printer-attributes-tag COUNT 1
	EXPECT document-format-supported OF-TYPE mimeMediaType IN-GROUP printer-attributes-tag WITH-VALUE "image/pwg-raster"
	EXPECT document-format-supported OF-TYPE mimeMediaType IN-GROUP printer-attributes-tag WITH-VALUE "image/jpeg" IF-DEFINED HAVE_COLOR
	EXPECT document-format-supported OF-TYPE mimeMediaType IN-GROUP printer-attributes-tag WITH-VALUE "image/jpeg" DEFINE-MATCH HAVE_JPEG
	EXPECT document-format-supported OF-TYPE mimeMediaType IN-GROUP printer-attributes-tag WITH-VALUE "application/pdf" DEFINE-MATCH HAVE_PDF

	EXPECT document-password-supported OF-TYPE integer IN-GROUP printer-attributes-tag COUNT 1 IF-DEFINED HAVE_PDF

	EXPECT generated-natural-language-supported OF-TYPE naturalLanguage IN-GROUP printer-attributes-tag

	EXPECT identify-actions-default OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-VALUE "/^(display|flash|sound|speak)$/" IF-DEFINED HAVE_IDENTIFY_PRINTER
	EXPECT identify-actions-supported OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-VALUE "/^(display|flash|sound|speak)$/" IF-DEFINED HAVE_IDENTIFY_PRINTER

	EXPECT ipp-versions-supported OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-VALUE "2.0"

	EXPECT job-constraints-supported OF-TYPE collection IN-GROUP printer-attributes-tag DEFINE-MATCH HAVE_JOB_CONSTRAINTS

	EXPECT job-creation-attributes-supported OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-VALUE "/^(media|print-color-mode)$$/"

	EXPECT job-ids-supported OF-TYPE boolean IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE true

	# TODO: Make job-password-xxx conditionally required if the printer supports "Print to a Recipient" (???)
	EXPECT job-password-supported OF-TYPE integer IN-GROUP printer-attributes-tag COUNT 1 DEFINE-MATCH PRINT_TO_A_RECIPIENT
	EXPECT job-password-encryption-supported OF-TYPE keyword IN-GROUP printer-attributes-tag IF-DEFINED PRINT_TO_A_RECIPIENT

	EXPECT job-resolvers-supported OF-TYPE collection IN-GROUP printer-attributes-tag IF-DEFINED HAVE_JOB_CONSTRAINTS

	EXPECT multiple-document-jobs-supported OF-TYPE boolean IN-GROUP printer-attributes-tag COUNT 1

	EXPECT multiple-operation-time-out OF-TYPE integer IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE >0

	EXPECT multiple-operation-time-out-action OF-TYPE keyword IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE "/^(abort-job|hold-job|process-job)$/"

	EXPECT natural-language-configured OF-TYPE naturalLanguage IN-GROUP printer-attributes-tag COUNT 1

	EXPECT operations-supported OF-TYPE enum IN-GROUP printer-attributes-tag

	EXPECT pages-per-minute OF-TYPE integer IN-GROUP printer-attributes-tag COUNT 1

	EXPECT pages-per-minute-color OF-TYPE integer IN-GROUP printer-attributes-tag COUNT 1 IF-DEFINED HAVE_COLOR
	EXPECT !pages-per-minute-color IF-NOT-DEFINED HAVE_COLOR

	EXPECT pdl-override-supported OF-TYPE keyword IN-GROUP printer-attributes-tag COUNT 1

	EXPECT preferred-attributes-supported OF-TYPE boolean IN-GROUP printer-attributes-tag COUNT 1

	EXPECT ?printer-alert OF-TYPE octetString IN-GROUP printer-attributes-tag WITH-ALL-VALUES "$ALERT_REGEX"
	EXPECT ?printer-alert-description OF-TYPE text IN-GROUP printer-attributes-tag SAME-COUNT-AS printer-alert

	EXPECT ?printer-charge-info OF-TYPE text IN-GROUP printer-attributes-tag COUNT 1 DEFINE-MATCH HAVE_CHARGE_INFO
	EXPECT printer-charge-info-uri OF-TYPE uri IN-GROUP printer-attributes-tag COUNT 1 IF-DEFINED HAVE_CHARGE_INFO

	EXPECT printer-config-change-date-time OF-TYPE dateTime|unknown|no-value IN-GROUP printer-attributes-tag COUNT 1

	EXPECT printer-config-change-time OF-TYPE integer IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE >-1

	EXPECT printer-current-time OF-TYPE dateTime|unknown|no-value IN-GROUP printer-attributes-tag COUNT 1

	EXPECT printer-geo-location OF-TYPE uri|unknown IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE "/^geo:/"

	EXPECT printer-get-attributes-supported OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-VALUE "document-format"

	EXPECT printer-icc-profiles-supported OF-TYPE collection IN-GROUP printer-attributes-tag DEFINE-MATCH HAVE_ICC_PROFILES
	EXPECT-ALL printer-icc-profiles-supported/profile-name OF-TYPE name COUNT 1 IF-DEFINED HAVE_ICC_PROFILES
	EXPECT-ALL printer-icc-profiles-supported/profile-uri OF-TYPE uri COUNT 1 WITH-VALUE "$HTTP_URI_SCHEME" IF-DEFINED HAVE_ICC_PROFILES

	EXPECT printer-icons OF-TYPE uri IN-GROUP printer-attributes-tag WITH-ALL-VALUES "$HTTP_URI_SCHEME"
	EXPECT printer-icons OF-TYPE uri WITH-ALL-HOSTNAMES "$hostname"

	EXPECT printer-info OF-TYPE text IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE "/^.{0,127}$$/"

	EXPECT printer-is-accepting-jobs OF-TYPE boolean IN-GROUP printer-attributes-tag COUNT 1

	EXPECT printer-location OF-TYPE text IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE "/^.{0,127}$$/"

	EXPECT printer-make-and-model OF-TYPE text IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE "/^.{0,127}$$/"

	EXPECT printer-more-info OF-TYPE uri IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE "$HTTP_URI_SCHEME"
	EXPECT printer-more-info WITH-HOSTNAME "$hostname"
	# EXPECT !printer-more-info WITH-HOSTNAME "$LINK_LOCAL"
	# TODO: Provide warnings when hostname doesn't match

	EXPECT printer-name OF-TYPE name IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE "/^.{0,127}$$/"

	EXPECT printer-organization OF-TYPE text IN-GROUP printer-attributes-tag

	EXPECT printer-organizational-unit OF-TYPE text IN-GROUP printer-attributes-tag

	EXPECT printer-state OF-TYPE enum IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE 3,4,5

	EXPECT printer-state-change-date-time OF-TYPE dateTime|unknown|no-value IN-GROUP printer-attributes-tag COUNT 1

	EXPECT printer-state-change-time OF-TYPE integer IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE >-1

	EXPECT printer-state-message OF-TYPE text IN-GROUP printer-attributes-tag

	EXPECT printer-state-reasons OF-TYPE keyword IN-GROUP printer-attributes-tag

	EXPECT printer-supply DEFINE-MATCH HAVE_PRINTER_SUPPLY
	EXPECT printer-supply-description DEFINE-MATCH HAVE_PRINTER_SUPPLY
	EXPECT printer-supply-info-uri DEFINE-MATCH HAVE_PRINTER_SUPPLY

	EXPECT printer-supply OF-TYPE octetString IN-GROUP printer-attributes-tag WITH-ALL-VALUES "$SUPPLY_REGEX" IF-DEFINED HAVE_PRINTER_SUPPLY

	EXPECT printer-supply-description OF-TYPE text IN-GROUP printer-attributes-tag SAME-COUNT-AS printer-supply IF-DEFINED HAVE_PRINTER_SUPPLY

	EXPECT printer-supply-info-uri OF-TYPE uri IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE "$HTTP_URI_SCHEME" IF-DEFINED HAVE_PRINTER_SUPPLY
	EXPECT printer-supply-info-uri WITH-HOSTNAME "$hostname" IF-DEFINED HAVE_PRINTER_SUPPLY
	# EXPECT !printer-supply-info-uri WITH-HOSTNAME "$LINK_LOCAL"

	EXPECT printer-up-time OF-TYPE integer IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE >0

	EXPECT printer-uri-supported OF-TYPE uri IN-GROUP printer-attributes-tag SAME-COUNT-AS uri-security-supported WITH-ALL-VALUES "$IPP_URI_SCHEME"
	# EXPECT !printer-uri-supported WITH-HOSTNAME "$LINK_LOCAL"

	EXPECT printer-uuid OF-TYPE uri IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE "$UUID_URI"

	EXPECT pwg-raster-document-resolution-supported OF-TYPE resolution IN-GROUP printer-attributes-tag
	EXPECT pwg-raster-document-resolution-supported DEFINE-VALUE RASTER_RESOLUTION

	EXPECT sides-supported OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-VALUE "/^two-sided-(long|short)-edge$$/" DEFINE-MATCH HAVE_DUPLEX
	EXPECT pwg-raster-document-sheet-back OF-TYPE keyword IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE "/^(flipped|manual-tumble|normal|rotated)$$/" IF-DEFINED HAVE_DUPLEX

	EXPECT pwg-raster-document-type-supported OF-TYPE keyword IN-GROUP printer-attributes-tag
	EXPECT pwg-raster-document-type-supported WITH-VALUE "black_1" DEFINE-MATCH HAVE_BLACK
	EXPECT pwg-raster-document-type-supported WITH-VALUE "sgray_8" DEFINE-MATCH HAVE_SGRAY
	EXPECT pwg-raster-document-type-supported WITH-VALUE "srgb_8" DEFINE-MATCH HAVE_SRGB

	EXPECT queued-job-count OF-TYPE integer IN-GROUP printer-attributes-tag COUNT 1

	EXPECT uri-authentication-supported OF-TYPE keyword IN-GROUP printer-attributes-tag

	EXPECT uri-security-supported OF-TYPE keyword IN-GROUP printer-attributes-tag SAME-COUNT-AS uri-authentication-supported

	EXPECT which-jobs-supported OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-VALUE "completed"
	EXPECT which-jobs-supported WITH-VALUE "not-completed"


	#### PWG 5100.14 - Table 6 - Printer Description Attributes that are part of the 'job-template' group
	EXPECT copies-default OF-TYPE integer IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE >0
	EXPECT copies-supported OF-TYPE rangeOfInteger IN-GROUP printer-attributes-tag

	EXPECT finishings-supported OF-TYPE enum IN-GROUP printer-attributes-tag DEFINE-MATCH HAVE_FINISHINGS

	EXPECT finishing-template-supported OF-TYPE keyword IN-GROUP printer-attributes-tag IF-DEFINED HAVE_FINISHINGS
	EXPECT finishing-template-supported WITH-VALUE "none" IF-DEFINED HAVE_FINISHINGS

	EXPECT finishings-col-database OF-TYPE collection IN-GROUP printer-attributes-tag IF-DEFINED HAVE_FINISHINGS
	EXPECT finishings-col-database/finishing-template OF-TYPE keyword|name IF-DEFINED HAVE_FINISHINGS

	EXPECT finishings-col-default OF-TYPE collection IN-GROUP printer-attributes-tag IF-DEFINED HAVE_FINISHINGS
	EXPECT finishings-col-default/finishing-template OF-TYPE keyword|name IF-DEFINED HAVE_FINISHINGS

	EXPECT finishings-col-ready OF-TYPE collection IN-GROUP printer-attributes-tag IF-DEFINED HAVE_FINISHINGS
	EXPECT finishings-col-ready/finishing-template OF-TYPE keyword|name IF-DEFINED HAVE_FINISHINGS

	EXPECT finishings-col-supported OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-VALUE "finishing-template" IF-DEFINED HAVE_FINISHINGS

	EXPECT finishings-default OF-TYPE enum IN-GROUP printer-attributes-tag WITH-VALUE-FROM "finishings-supported" IF-DEFINED HAVE_FINISHINGS

	EXPECT ?finishings-ready OF-TYPE enum IN-GROUP printer-attributes-tag WITH-VALUE-FROM "finishings-supported"

	EXPECT finishings-supported OF-TYPE enum IN-GROUP printer-attributes-tag IF-DEFINED HAVE_FINISHINGS
	EXPECT finishings-supported WITH-VALUE 3 IF-DEFINED HAVE_FINISHINGS

	EXPECT job-account-id-supported OF-TYPE boolean IN-GROUP printer-attributes-tag WITH-VALUE true COUNT 1 DEFINE-MATCH HAVE_JOB_ACCOUNT_ID
	EXPECT job-account-id-default OF-TYPE name|no-value IN-GROUP printer-attributes-tag COUNT 1 IF-DEFINED HAVE_JOB_ACCOUNT_ID

	EXPECT job-accounting-user-id-supported OF-TYPE boolean IN-GROUP printer-attributes-tag WITH-VALUE true COUNT 1 DEFINE-MATCH HAVE_JOB_ACCOUNTING_USER_ID
	EXPECT job-accounting-user-id-default OF-TYPE name|no-value IN-GROUP printer-attributes-tag COUNT 1 IF-DEFINED HAVE_JOB_ACCOUNTING_USER_ID

	EXPECT media-bottom-margin-supported OF-TYPE integer IN-GROUP printer-attributes-tag WITH-ALL-VALUES >-1

	EXPECT media-col-supported OF-TYPE keyword IN-GROUP printer-attributes-tag
	EXPECT media-col-supported WITH-VALUE "media-size"

	EXPECT media-default OF-TYPE no-value|keyword|name IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE "$MEDIA_REGEX"
	EXPECT media-default WITH-VALUE "$MEDIA_REGEX" DEFINE-VALUE DEFAULT_MEDIA

	EXPECT media-left-margin-supported OF-TYPE integer IN-GROUP printer-attributes-tag WITH-ALL-VALUES >-1

	EXPECT media-ready OF-TYPE keyword|name|no-value IN-GROUP printer-attributes-tag WITH-ALL-VALUES "$MEDIA_REGEX"

	EXPECT media-right-margin-supported OF-TYPE integer IN-GROUP printer-attributes-tag WITH-ALL-VALUES >-1

	EXPECT media-size-supported OF-TYPE collection IN-GROUP printer-attributes-tag
	EXPECT-ALL media-size-supported/x-dimension OF-TYPE integer|rangeOfInteger
	EXPECT-ALL media-size-supported/y-dimension OF-TYPE integer|rangeOfInteger

	EXPECT media-source-supported OF-TYPE keyword|name IN-GROUP printer-attributes-tag DEFINE-MATCH HAVE_MEDIA_SOURCE
	EXPECT media-col-supported WITH-VALUE "media-source" IF-DEFINED HAVE_MEDIA_SOURCE

	EXPECT media-supported OF-TYPE keyword|name IN-GROUP printer-attributes-tag WITH-ALL-VALUES "$MEDIA_REGEX"

	EXPECT media-top-margin-supported OF-TYPE integer IN-GROUP printer-attributes-tag WITH-ALL-VALUES >-1

	EXPECT media-type-supported OF-TYPE keyword|name IN-GROUP printer-attributes-tag DEFINE-MATCH HAVE_MEDIA_TYPE
	EXPECT media-col-supported WITH-VALUE "media-type" IF-DEFINED HAVE_MEDIA_TYPE

	EXPECT media-col-default OF-TYPE collection IN-GROUP printer-attributes-tag COUNT 1
	EXPECT media-col-default/media-size OF-TYPE collection COUNT 1
	EXPECT media-col-default/media-size/x-dimension OF-TYPE integer COUNT 1 WITH-VALUE >0
	EXPECT media-col-default/media-size/y-dimension OF-TYPE integer COUNT 1 WITH-VALUE >0
	EXPECT media-col-default/media-source OF-TYPE keyword|name COUNT 1 IF-DEFINED HAVE_MEDIA_SOURCE
	EXPECT media-col-default/media-type OF-TYPE keyword|name COUNT 1 IF-DEFINED HAVE_MEDIA_TYPE

	EXPECT media-col-ready OF-TYPE collection|no-value IN-GROUP printer-attributes-tag
	EXPECT-ALL media-col-ready/media-size OF-TYPE collection COUNT 1
	EXPECT-ALL media-col-ready/media-size/x-dimension OF-TYPE integer COUNT 1 WITH-VALUE >0
	EXPECT-ALL media-col-ready/media-size/y-dimension OF-TYPE integer COUNT 1 WITH-VALUE >0
	EXPECT-ALL media-col-ready/media-source OF-TYPE keyword|name COUNT 1 IF-DEFINED HAVE_MEDIA_SOURCE
	EXPECT-ALL ?media-col-ready/media-source-properties OF-TYPE collection COUNT 1
	EXPECT-ALL media-col-ready/media-type OF-TYPE keyword|name COUNT 1 IF-DEFINED HAVE_MEDIA_TYPE

	EXPECT orientation-requested-default OF-TYPE no-value|enum IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE-FROM "orientation-requested-supported"
	EXPECT orientation-requested-supported OF-TYPE enum IN-GROUP printer-attributes-tag WITH-VALUE 3,4,5,6,7

	EXPECT output-bin-default OF-TYPE keyword|name IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE-FROM "output-bin-supported"
	EXPECT output-bin-default DEFINE-VALUE DEFAULT_OUTPUT_BIN
	EXPECT output-bin-supported OF-TYPE keyword|name IN-GROUP printer-attributes-tag

	EXPECT overrides-supported OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-VALUE "pages" IF-DEFINED HAVE_PDF

	EXPECT page-ranges-supported OF-TYPE boolean IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE true IF-DEFINED HAVE_PDF

	EXPECT print-color-mode-default OF-TYPE keyword IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE-FROM "print-color-mode-supported"
	EXPECT print-color-mode-default DEFINE-VALUE DEFAULT_PRINT_COLOR_MODE
	EXPECT print-color-mode-supported OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-ALL-VALUES "/^(auto|auto-monochrome|bi-level|color|highlight|monochrome|process-bi-level|process-monochrome)$/"

	EXPECT ?print-content-optimize-supported OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-ALL-VALUES "/^(auto|graphic|photo|text|text-and-graphic)$/"
	EXPECT print-content-optimize-supported DEFINE-MATCH HAVE_PRINT_CONTENT_OPTIMIZE
	EXPECT print-content-optimize-default OF-TYPE keyword IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE-FROM "print-content-optimize-supported" IF-DEFINED HAVE_PRINT_CONTENT_OPTIMIZE

	EXPECT print-quality-default OF-TYPE enum IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE-FROM "print-quality-supported"
	EXPECT print-quality-default DEFINE-VALUE DEFAULT_PRINT_QUALITY
	EXPECT print-quality-supported OF-TYPE enum IN-GROUP printer-attributes-tag WITH-VALUE 3,4,5

	EXPECT print-rendering-intent-default OF-TYPE keyword IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE-FROM "print-rendering-intent-supported" IF-DEFINED HAVE_ICC_PROFILES
	EXPECT print-rendering-intent-default DEFINE-VALUE DEFAULT_PRINT_RENDERING_INTENT
	EXPECT print-rendering-intent-supported OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-ALL-VALUES "/^(auto|absolute|perceptual|relative|relative-bpc|saturation)$/" IF-DEFINED HAVE_ICC_PROFILES

	EXPECT printer-resolution-default OF-TYPE resolution IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE-FROM "printer-resolution-supported"
	EXPECT printer-resolution-default DEFINE-VALUE DEFAULT_PRINTER_RESOLUTION
	EXPECT printer-resolution-supported OF-TYPE resolution IN-GROUP printer-attributes-tag

	EXPECT sides-default OF-TYPE keyword IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE-FROM "sides-supported"
	EXPECT sides-default DEFINE-VALUE DEFAULT_SIDES
	EXPECT sides-supported OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-ALL-VALUES "/^(one-sided|two-sided-long-edge|two-sided-short-edge)$$/"

	# Recommended attributes
	EXPECT ?job-account-type-default OF-TYPE keyword IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE-FROM "job-account-type-supported"
	EXPECT ?job-account-type-supported OF-TYPE keyword IN-GROUP printer-attributes-tag

	EXPECT ?job-authorization-uri-supported OF-TYPE boolean IN-GROUP printer-attributes-tag COUNT 1

	EXPECT ?job-mandatory-attributes-supported OF-TYPE boolean IN-GROUP printer-attributes-tag COUNT 1

	EXPECT ?job-password-repertoire-configured OF-TYPE keyword IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE-FROM "job-password-repertoire-supported"
	EXPECT ?job-password-repertoire-supported OF-TYPE keyword IN-GROUP printer-attributes-tag

	EXPECT ?job-presets-supported OF-TYPE collection IN-GROUP printer-attributes-tag

	EXPECT ?job-privacy-attributes OF-TYPE keyword IN-GROUP printer-attributes-tag
	EXPECT ?job-privacy-scope OF-TYPE keyword IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE "/^(all|default|owner|none)$$/"
	EXPECT ?printer-privacy-policy-uri OF-TYPE uri IN-GROUP printer-attributes-tag COUNT 1

	EXPECT ?jpeg-features-supported OF-TYPE keyword IN-GROUP printer-attributes-tag
	EXPECT ?jpeg-k-octets-supported OF-TYPE rangeOfInteger IN-GROUP printer-attributes-tag COUNT 1
	EXPECT ?jpeg-x-dimension-supported OF-TYPE rangeOfInteger IN-GROUP printer-attributes-tag COUNT 1
	EXPECT ?jpeg-y-dimension-supported OF-TYPE rangeOfInteger IN-GROUP printer-attributes-tag COUNT 1

	EXPECT ?pdf-k-octets-supported OF-TYPE rangeOfInteger IN-GROUP printer-attributes-tag COUNT 1
	EXPECT ?pdf-versions-supported OF-TYPE keyword IN-GROUP printer-attributes-tag

	EXPECT ?print-scaling-default OF-TYPE keyword IN-GROUP printer-attributes-tag COUNT 1 WITH-VALUE-FROM "print-scaling-supported"
	EXPECT ?print-scaling-supported OF-TYPE keyword IN-GROUP printer-attributes-tag

	EXPECT ?printer-dns-sd-name OF-TYPE name IN-GROUP printer-attributes-tag COUNT 1

	EXPECT ?printer-input-tray OF-TYPE octetString IN-GROUP printer-attributes-tag SAME-COUNT-AS "media-source-supported"
	EXPECT ?printer-output-tray OF-TYPE octetString IN-GROUP printer-attributes-tag SAME-COUNT-AS "output-bin-supported"
}

#
# Test different values of requested-attributes
#
{
	NAME "I-10.1 Get-Printer-Attributes Operation (all)"

	OPERATION Get-Printer-Attributes

	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR language attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR keyword requested-attributes 'all'

	STATUS successful-ok

	# 'media-col-database' attribute should never be returned unless
	# explicitly requested...
	EXPECT !media-col-database

	# 'printer-description' attributes
	EXPECT charset-configured
	EXPECT charset-supported
	EXPECT color-supported
	EXPECT compression-supported
	EXPECT document-format-default
	EXPECT document-format-supported
	EXPECT generated-natural-language-supported
	EXPECT identify-actions-default
	EXPECT identify-actions-supported
	EXPECT ipp-features-supported
	EXPECT ipp-versions-supported
	EXPECT job-constraints-supported IF-DEFINED HAVE_JOB_CONSTRAINTS
	EXPECT job-creation-attributes-supported
	EXPECT job-ids-supported
	EXPECT job-password-supported IF-DEFINED HAVE_PRINT_TO_A_RECIPIENT
	EXPECT job-password-encryption-supported IF-DEFINED HAVE_PRINT_TO_A_RECIPIENT
	EXPECT job-resolvers-supported IF-DEFINED HAVE_JOB_CONSTRAINTS
	EXPECT multiple-document-jobs-supported
	EXPECT multiple-operation-time-out
	EXPECT multiple-operation-time-out-action
	EXPECT natural-language-configured
        EXPECT operations-supported
        EXPECT pages-per-minute
        EXPECT pages-per-minute-color IF-DEFINED HAVE_COLOR
        EXPECT !pages-per-minute-color IF-NOT-DEFINED HAVE_COLOR
	EXPECT pdl-override-supported
        EXPECT preferred-attributes-supported
	EXPECT printer-charge-info-uri IF-DEFINED HAVE_CHARGE_INFO
	EXPECT printer-config-change-date-time
	EXPECT printer-config-change-time
	EXPECT printer-current-time
	EXPECT printer-geo-location
	EXPECT printer-get-attributes-supported
	EXPECT printer-icc-profiles-supported IF-DEFINED HAVE_ICC_PROFILES
	EXPECT printer-icons
	EXPECT printer-info
	EXPECT printer-is-accepting-jobs
	EXPECT printer-location
	EXPECT printer-make-and-model
	EXPECT printer-more-info
	EXPECT printer-name
	EXPECT printer-organization
	EXPECT printer-organizational-unit
	EXPECT printer-state
	EXPECT printer-state-change-date-time
	EXPECT printer-state-change-time
	EXPECT printer-state-message
	EXPECT printer-state-reasons
	EXPECT printer-supply IF-DEFINED HAVE_PRINTER_SUPPLY
	EXPECT printer-supply-description IF-DEFINED HAVE_PRINTER_SUPPLY
	EXPECT printer-supply-info-uri IF-DEFINED HAVE_PRINTER_SUPPLY
	EXPECT printer-up-time
	EXPECT printer-uri-supported
	EXPECT printer-uuid
	EXPECT pwg-raster-document-resolution-supported
	EXPECT pwg-raster-document-sheet-back IF-DEFINED HAVE_DUPLEX
	EXPECT pwg-raster-document-type-supported
	EXPECT queued-job-count
	EXPECT uri-authentication-supported
	EXPECT uri-security-supported
	EXPECT which-jobs-supported

	# 'job-template' attributes
	EXPECT copies-default
	EXPECT copies-supported
	EXPECT finishings-default IF-DEFINED HAVE_FINISHINGS
	EXPECT finishings-supported IF-DEFINED HAVE_FINISHINGS
	EXPECT media-bottom-margin-supported
	EXPECT media-col-default
	EXPECT media-col-ready
	EXPECT media-col-supported
	EXPECT media-default
	EXPECT media-left-margin-supported
	EXPECT media-ready
	EXPECT media-right-margin-supported
	EXPECT media-size-supported
	EXPECT media-source-supported IF-DEFINED HAVE_MEDIA_SOURCE
	EXPECT media-supported
	EXPECT media-top-margin-supported
	EXPECT media-type-supported IF-DEFINED HAVE_MEDIA_TYPE
	EXPECT orientation-requested-default
	EXPECT orientation-requested-supported
	EXPECT output-bin-default
	EXPECT output-bin-supported
	EXPECT overrides-supported IF-DEFINED HAVE_PDF
	EXPECT page-ranges-supported IF-DEFINED HAVE_PDF
	EXPECT print-color-mode-default
	EXPECT print-color-mode-supported
	EXPECT print-content-optimize-default IF-DEFINED HAVE_PRINT_CONTENT_OPTIMIZE
	EXPECT print-content-optimize-supported IF-DEFINED HAVE_PRINT_CONTENT_OPTIMIZE
	EXPECT print-quality-default
	EXPECT print-quality-supported
	EXPECT print-rendering-intent-default IF-DEFINED HAVE_ICC_PROFILES
	EXPECT print-rendering-intent-supported IF-DEFINED HAVE_ICC_PROFILES
	EXPECT printer-resolution-default
	EXPECT printer-resolution-supported
	EXPECT sides-default IF-DEFINED HAVE_DUPLEX
	EXPECT sides-supported IF-DEFINED HAVE_DUPLEX
}
{
	NAME "I-10.2. Get-Printer-Attributes Operation (all, media-col-database)"

	OPERATION Get-Printer-Attributes

	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR language attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR keyword requested-attributes all,media-col-database

	STATUS successful-ok

	# 'media-col-database' attribute should never be returned unless
	# explicitly requested...
	EXPECT media-col-database OF-TYPE collection IN-GROUP printer-attributes-tag

	# 'printer-description' attributes
	EXPECT charset-configured
	EXPECT charset-supported
	EXPECT color-supported
	EXPECT compression-supported
	EXPECT document-format-default
	EXPECT document-format-supported
	EXPECT generated-natural-language-supported
	EXPECT identify-actions-default
	EXPECT identify-actions-supported
	EXPECT ipp-features-supported
	EXPECT ipp-versions-supported
	EXPECT job-constraints-supported IF-DEFINED HAVE_JOB_CONSTRAINTS
	EXPECT job-creation-attributes-supported
	EXPECT job-ids-supported
	EXPECT job-password-supported IF-DEFINED HAVE_PRINT_TO_A_RECIPIENT
	EXPECT job-password-encryption-supported IF-DEFINED HAVE_PRINT_TO_A_RECIPIENT
	EXPECT job-resolvers-supported IF-DEFINED HAVE_JOB_CONSTRAINTS
	EXPECT multiple-document-jobs-supported
	EXPECT multiple-operation-time-out
	EXPECT multiple-operation-time-out-action
	EXPECT natural-language-configured
        EXPECT operations-supported
        EXPECT pages-per-minute
        EXPECT pages-per-minute-color IF-DEFINED HAVE_COLOR
        EXPECT !pages-per-minute-color IF-NOT-DEFINED HAVE_COLOR
	EXPECT pdl-override-supported
        EXPECT preferred-attributes-supported
	EXPECT printer-charge-info-uri IF-DEFINED HAVE_CHARGE_INFO
	EXPECT printer-config-change-date-time
	EXPECT printer-config-change-time
	EXPECT printer-current-time
	EXPECT printer-geo-location
	EXPECT printer-get-attributes-supported
	EXPECT printer-icc-profiles-supported IF-DEFINED HAVE_ICC_PROFILES
	EXPECT printer-icons
	EXPECT printer-info
	EXPECT printer-is-accepting-jobs
	EXPECT printer-location
	EXPECT printer-make-and-model
	EXPECT printer-more-info
	EXPECT printer-name
	EXPECT printer-organization
	EXPECT printer-organizational-unit
	EXPECT printer-state
	EXPECT printer-state-change-date-time
	EXPECT printer-state-change-time
	EXPECT printer-state-message
	EXPECT printer-state-reasons
	EXPECT printer-supply IF-DEFINED HAVE_PRINTER_SUPPLY
	EXPECT printer-supply-description IF-DEFINED HAVE_PRINTER_SUPPLY
	EXPECT printer-supply-info-uri IF-DEFINED HAVE_PRINTER_SUPPLY
	EXPECT printer-up-time
	EXPECT printer-uri-supported
	EXPECT printer-uuid
	EXPECT pwg-raster-document-resolution-supported
	EXPECT pwg-raster-document-sheet-back IF-DEFINED HAVE_DUPLEX
	EXPECT pwg-raster-document-type-supported
	EXPECT queued-job-count
	EXPECT uri-authentication-supported
	EXPECT uri-security-supported
	EXPECT which-jobs-supported

	# 'job-template' attributes
	EXPECT copies-default
	EXPECT copies-supported
	EXPECT finishings-default IF-DEFINED HAVE_FINISHINGS
	EXPECT finishings-supported IF-DEFINED HAVE_FINISHINGS
	EXPECT media-bottom-margin-supported
	EXPECT media-col-default
	EXPECT media-col-ready
	EXPECT media-col-supported
	EXPECT media-default
	EXPECT media-left-margin-supported
	EXPECT media-ready
	EXPECT media-right-margin-supported
	EXPECT media-size-supported
	EXPECT media-source-supported IF-DEFINED HAVE_MEDIA_SOURCE
	EXPECT media-supported
	EXPECT media-top-margin-supported
	EXPECT media-type-supported IF-DEFINED HAVE_MEDIA_TYPE
	EXPECT orientation-requested-default
	EXPECT orientation-requested-supported
	EXPECT output-bin-default
	EXPECT output-bin-supported
	EXPECT overrides-supported IF-DEFINED HAVE_PDF
	EXPECT page-ranges-supported IF-DEFINED HAVE_PDF
	EXPECT print-color-mode-default
	EXPECT print-color-mode-supported
	EXPECT print-content-optimize-default IF-DEFINED HAVE_PRINT_CONTENT_OPTIMIZE
	EXPECT print-content-optimize-supported IF-DEFINED HAVE_PRINT_CONTENT_OPTIMIZE
	EXPECT print-quality-default
	EXPECT print-quality-supported
	EXPECT print-rendering-intent-default IF-DEFINED HAVE_ICC_PROFILES
	EXPECT print-rendering-intent-supported IF-DEFINED HAVE_ICC_PROFILES
	EXPECT printer-resolution-default
	EXPECT printer-resolution-supported
	EXPECT sides-default IF-DEFINED HAVE_DUPLEX
	EXPECT sides-supported IF-DEFINED HAVE_DUPLEX
}

{
	NAME "I-10.3. Get-Printer-Attributes Operation (none)"

	OPERATION Get-Printer-Attributes

	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR language attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR keyword requested-attributes 'none'

	STATUS successful-ok

	# 'media-col-database' attribute should never be returned unless
	# explicitly requested...
	EXPECT !media-col-database

	# 'printer-description' attributes
	EXPECT !charset-configured
	EXPECT !charset-supported
	EXPECT !color-supported
	EXPECT !compression-supported
	EXPECT !document-format-default
	EXPECT !document-format-supported
	EXPECT !generated-natural-language-supported
	EXPECT !identify-actions-default
	EXPECT !identify-actions-supported
	EXPECT !ipp-features-supported
	EXPECT !ipp-versions-supported
	EXPECT !job-constraints-supported
	EXPECT !job-creation-attributes-supported
	EXPECT !job-ids-supported
	EXPECT !job-password-supported
	EXPECT !job-password-encryption-supported
	EXPECT !job-resolvers-supported
	EXPECT !multiple-document-jobs-supported
	EXPECT !multiple-operation-time-out
	EXPECT !multiple-operation-time-out-action
	EXPECT !natural-language-configured
        EXPECT !operations-supported
        EXPECT !pages-per-minute
        EXPECT !pages-per-minute-color
        EXPECT !!pages-per-minute-color
	EXPECT !pdl-override-supported
        EXPECT !preferred-attributes-supported
	EXPECT !printer-charge-info-uri
	EXPECT !printer-config-change-date-time
	EXPECT !printer-config-change-time
	EXPECT !printer-current-time
	EXPECT !printer-geo-location
	EXPECT !printer-get-attributes-supported
	EXPECT !printer-icc-profiles-supported
	EXPECT !printer-icons
	EXPECT !printer-info
	EXPECT !printer-is-accepting-jobs
	EXPECT !printer-location
	EXPECT !printer-make-and-model
	EXPECT !printer-more-info
	EXPECT !printer-name
	EXPECT !printer-organization
	EXPECT !printer-organizational-unit
	EXPECT !printer-state
	EXPECT !printer-state-change-date-time
	EXPECT !printer-state-change-time
	EXPECT !printer-state-message
	EXPECT !printer-state-reasons
	EXPECT !printer-supply
	EXPECT !printer-supply-description
	EXPECT !printer-supply-info-uri
	EXPECT !printer-up-time
	EXPECT !printer-uri-supported
	EXPECT !printer-uuid
	EXPECT !pwg-raster-document-resolution-supported
	EXPECT !pwg-raster-document-sheet-back
	EXPECT !pwg-raster-document-type-supported
	EXPECT !queued-job-count
	EXPECT !uri-authentication-supported
	EXPECT !uri-security-supported
	EXPECT !which-jobs-supported

	# 'job-template' attributes
	EXPECT !copies-default
	EXPECT !copies-supported
	EXPECT !finishings-default
	EXPECT !finishings-supported
	EXPECT !media-bottom-margin-supported
	EXPECT !media-col-default
	EXPECT !media-col-ready
	EXPECT !media-col-supported
	EXPECT !media-default
	EXPECT !media-left-margin-supported
	EXPECT !media-ready
	EXPECT !media-right-margin-supported
	EXPECT !media-size-supported
	EXPECT !media-source-supported
	EXPECT !media-supported
	EXPECT !media-top-margin-supported
	EXPECT !media-type-supported
	EXPECT !orientation-requested-default
	EXPECT !orientation-requested-supported
	EXPECT !output-bin-default
	EXPECT !output-bin-supported
	EXPECT !overrides-supported
	EXPECT !page-ranges-supported
	EXPECT !print-color-mode-default
	EXPECT !print-color-mode-supported
	EXPECT !print-content-optimize-default
	EXPECT !print-content-optimize-supported
	EXPECT !print-quality-default
	EXPECT !print-quality-supported
	EXPECT !print-rendering-intent-default
	EXPECT !print-rendering-intent-supported
	EXPECT !printer-resolution-default
	EXPECT !printer-resolution-supported
	EXPECT !sides-default IF-DEFINED HAVE_DUPLEX
	EXPECT !sides-supported IF-DEFINED HAVE_DUPLEX
}

{
	NAME "I-10.4. Get-Printer-Attributes Operation (media-col-database)"

	OPERATION Get-Printer-Attributes

	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR language attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR keyword requested-attributes 'media-col-database'

	STATUS successful-ok

	# 'media-col-database' attribute should never be returned unless
	# explicitly requested...
	EXPECT media-col-database OF-TYPE collection IN-GROUP printer-attributes-tag

	## Issue #50: Relax Get-Printer-Attributes tests
	# 'printer-description' attributes
	# EXPECT !charset-configured
	# EXPECT !charset-supported
	# EXPECT !color-supported
	# EXPECT !compression-supported
	# EXPECT !document-format-default
	# EXPECT !document-format-supported
	# EXPECT !generated-natural-language-supported
	# EXPECT !identify-actions-default
	# EXPECT !identify-actions-supported
	# EXPECT !ipp-features-supported
	# EXPECT !ipp-versions-supported
	# EXPECT !job-constraints-supported
	# EXPECT !job-creation-attributes-supported
	# EXPECT !job-ids-supported
	# EXPECT !job-password-supported
	# EXPECT !job-password-encryption-supported
	# EXPECT !job-resolvers-supported
	# EXPECT !multiple-document-jobs-supported
	# EXPECT !multiple-operation-time-out
	# EXPECT !multiple-operation-time-out-action
	# EXPECT !natural-language-configured
	# EXPECT !operations-supported
	# EXPECT !pages-per-minute
	# EXPECT !pages-per-minute-color
	# EXPECT !!pages-per-minute-color
	# EXPECT !pdl-override-supported
	# EXPECT !preferred-attributes-supported
	# EXPECT !printer-charge-info-uri
	# EXPECT !printer-config-change-date-time
	# EXPECT !printer-config-change-time
	# EXPECT !printer-current-time
	# EXPECT !printer-geo-location
	# EXPECT !printer-get-attributes-supported
	# EXPECT !printer-icc-profiles-supported
	# EXPECT !printer-icons
	# EXPECT !printer-info
	# EXPECT !printer-is-accepting-jobs
	# EXPECT !printer-location
	# EXPECT !printer-make-and-model
	# EXPECT !printer-more-info
	# EXPECT !printer-name
	# EXPECT !printer-organization
	# EXPECT !printer-organizational-unit
	# EXPECT !printer-state
	# EXPECT !printer-state-change-date-time
	# EXPECT !printer-state-change-time
	# EXPECT !printer-state-message
	# EXPECT !printer-state-reasons
	# EXPECT !printer-supply
	# EXPECT !printer-supply-description
	# EXPECT !printer-supply-info-uri
	# EXPECT !printer-up-time
	# EXPECT !printer-uri-supported
	# EXPECT !printer-uuid
	# EXPECT !pwg-raster-document-resolution-supported
	# EXPECT !pwg-raster-document-sheet-back
	# EXPECT !pwg-raster-document-type-supported
	# EXPECT !queued-job-count
	# EXPECT !uri-authentication-supported
	# EXPECT !uri-security-supported
	# EXPECT !which-jobs-supported

	# 'job-template' attributes
	# EXPECT !copies-default
	# EXPECT !copies-supported
	# EXPECT !finishings-default
	# EXPECT !finishings-supported
	# EXPECT !media-bottom-margin-supported
	# EXPECT !media-col-default
	# EXPECT !media-col-ready
	# EXPECT !media-col-supported
	# EXPECT !media-default
	# EXPECT !media-left-margin-supported
	# EXPECT !media-ready
	# EXPECT !media-right-margin-supported
	# EXPECT !media-size-supported
	# EXPECT !media-source-supported
	# EXPECT !media-supported
	# EXPECT !media-top-margin-supported
	# EXPECT !media-type-supported
	# EXPECT !orientation-requested-default
	# EXPECT !orientation-requested-supported
	# EXPECT !output-bin-default
	# EXPECT !output-bin-supported
	# EXPECT !overrides-supported
	# EXPECT !page-ranges-supported
	# EXPECT !print-color-mode-default
	# EXPECT !print-color-mode-supported
	# EXPECT !print-content-optimize-default
	# EXPECT !print-content-optimize-supported
	# EXPECT !print-quality-default
	# EXPECT !print-quality-supported
	# EXPECT !print-rendering-intent-default
	# EXPECT !print-rendering-intent-supported
	# EXPECT !printer-resolution-default
	# EXPECT !printer-resolution-supported
	# EXPECT !sides-default IF-DEFINED HAVE_DUPLEX
	# EXPECT !sides-supported IF-DEFINED HAVE_DUPLEX
}

{
	NAME "I-10.5. Get-Printer-Attributes Operation (printer-description)"

	OPERATION Get-Printer-Attributes

	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR language attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR keyword requested-attributes 'printer-description'

	STATUS successful-ok

	# 'media-col-database' attribute should never be returned unless
	# explicitly requested...
	EXPECT !media-col-database

	# 'printer-description' attributes
	EXPECT charset-configured
	EXPECT charset-supported
	EXPECT color-supported
	EXPECT compression-supported
	EXPECT document-format-default
	EXPECT document-format-supported
	EXPECT generated-natural-language-supported
	EXPECT identify-actions-default
	EXPECT identify-actions-supported
	EXPECT ipp-features-supported
	EXPECT ipp-versions-supported
	EXPECT job-constraints-supported IF-DEFINED HAVE_JOB_CONSTRAINTS
	EXPECT job-creation-attributes-supported
	EXPECT job-ids-supported
	EXPECT job-password-supported IF-DEFINED HAVE_PRINT_TO_A_RECIPIENT
	EXPECT job-password-encryption-supported IF-DEFINED HAVE_PRINT_TO_A_RECIPIENT
	EXPECT job-resolvers-supported IF-DEFINED HAVE_JOB_CONSTRAINTS
	EXPECT multiple-document-jobs-supported
	EXPECT multiple-operation-time-out
	EXPECT multiple-operation-time-out-action
	EXPECT natural-language-configured
        EXPECT operations-supported
        EXPECT pages-per-minute
        EXPECT pages-per-minute-color IF-DEFINED HAVE_COLOR
        EXPECT !pages-per-minute-color IF-NOT-DEFINED HAVE_COLOR
	EXPECT pdl-override-supported
        EXPECT preferred-attributes-supported
	EXPECT printer-charge-info-uri IF-DEFINED HAVE_CHARGE_INFO
	EXPECT printer-config-change-date-time
	EXPECT printer-config-change-time
	EXPECT printer-current-time
	EXPECT printer-geo-location
	EXPECT printer-get-attributes-supported
	EXPECT printer-icc-profiles-supported IF-DEFINED HAVE_ICC_PROFILES
	EXPECT printer-icons
	EXPECT printer-info
	EXPECT printer-is-accepting-jobs
	EXPECT printer-location
	EXPECT printer-make-and-model
	EXPECT printer-more-info
	EXPECT printer-name
	EXPECT printer-organization
	EXPECT printer-organizational-unit
	EXPECT printer-state
	EXPECT printer-state-change-date-time
	EXPECT printer-state-change-time
	EXPECT printer-state-message
	EXPECT printer-state-reasons
	EXPECT printer-supply IF-DEFINED HAVE_PRINTER_SUPPLY
	EXPECT printer-supply-description IF-DEFINED HAVE_PRINTER_SUPPLY
	EXPECT printer-supply-info-uri IF-DEFINED HAVE_PRINTER_SUPPLY
	EXPECT printer-up-time
	EXPECT printer-uri-supported
	EXPECT printer-uuid
	EXPECT pwg-raster-document-resolution-supported
	EXPECT pwg-raster-document-sheet-back IF-DEFINED HAVE_DUPLEX
	EXPECT pwg-raster-document-type-supported
	EXPECT queued-job-count
	EXPECT uri-authentication-supported
	EXPECT uri-security-supported
	EXPECT which-jobs-supported

	## Issue #50: Relax Get-Printer-Attributes tests
	# 'job-template' attributes
	# EXPECT !copies-default
	# EXPECT !copies-supported
	# EXPECT !finishings-default
	# EXPECT !finishings-supported
	# EXPECT !media-bottom-margin-supported
	# EXPECT !media-col-default
	# EXPECT !media-col-ready
	# EXPECT !media-col-supported
	# EXPECT !media-default
	# EXPECT !media-left-margin-supported
	# EXPECT !media-ready
	# EXPECT !media-right-margin-supported
	# EXPECT !media-size-supported
	# EXPECT !media-source-supported
	# EXPECT !media-supported
	# EXPECT !media-top-margin-supported
	# EXPECT !media-type-supported
	# EXPECT !orientation-requested-default
	# EXPECT !orientation-requested-supported
	# EXPECT !output-bin-default
	# EXPECT !output-bin-supported
	# EXPECT !overrides-supported
	# EXPECT !page-ranges-supported
	# EXPECT !print-color-mode-default
	# EXPECT !print-color-mode-supported
	# EXPECT !print-content-optimize-default
	# EXPECT !print-content-optimize-supported
	# EXPECT !print-quality-default
	# EXPECT !print-quality-supported
	# EXPECT !print-rendering-intent-default
	# EXPECT !print-rendering-intent-supported
	# EXPECT !printer-resolution-default
	# EXPECT !printer-resolution-supported
	# EXPECT !sides-default IF-DEFINED HAVE_DUPLEX
	# EXPECT !sides-supported IF-DEFINED HAVE_DUPLEX
}

{
	NAME "I-10.6. Get-Printer-Attributes Operation (job-template)"

	OPERATION Get-Printer-Attributes

	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR language attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR keyword requested-attributes 'job-template'

	STATUS successful-ok

	# 'media-col-database' attribute should never be returned unless
	# explicitly requested...
	EXPECT !media-col-database

	## Issue #50: Relax Get-Printer-Attributes tests
	# 'printer-description' attributes
	# EXPECT !charset-configured
	# EXPECT !charset-supported
	# EXPECT !color-supported
	# EXPECT !compression-supported
	# EXPECT !document-format-default
	# EXPECT !document-format-supported
	# EXPECT !generated-natural-language-supported
	# EXPECT !identify-actions-default
	# EXPECT !identify-actions-supported
	# EXPECT !ipp-features-supported
	# EXPECT !ipp-versions-supported
	# EXPECT !job-constraints-supported
	# EXPECT !job-creation-attributes-supported
	# EXPECT !job-ids-supported
	# EXPECT !job-password-supported
	# EXPECT !job-password-encryption-supported
	# EXPECT !job-resolvers-supported
	# EXPECT !multiple-document-jobs-supported
	# EXPECT !multiple-operation-time-out
	# EXPECT !multiple-operation-time-out-action
	# EXPECT !natural-language-configured
	# EXPECT !operations-supported
	# EXPECT !pages-per-minute
	# EXPECT !pages-per-minute-color
	# EXPECT !!pages-per-minute-color
	# EXPECT !pdl-override-supported
	# EXPECT !preferred-attributes-supported
	# EXPECT !printer-charge-info-uri
	# EXPECT !printer-config-change-date-time
	# EXPECT !printer-config-change-time
	# EXPECT !printer-current-time
	# EXPECT !printer-geo-location
	# EXPECT !printer-get-attributes-supported
	# EXPECT !printer-icc-profiles-supported
	# EXPECT !printer-icons
	# EXPECT !printer-info
	# EXPECT !printer-is-accepting-jobs
	# EXPECT !printer-location
	# EXPECT !printer-make-and-model
	# EXPECT !printer-more-info
	# EXPECT !printer-name
	# EXPECT !printer-organization
	# EXPECT !printer-organizational-unit
	# EXPECT !printer-state
	# EXPECT !printer-state-change-date-time
	# EXPECT !printer-state-change-time
	# EXPECT !printer-state-message
	# EXPECT !printer-state-reasons
	# EXPECT !printer-supply
	# EXPECT !printer-supply-description
	# EXPECT !printer-supply-info-uri
	# EXPECT !printer-up-time
	# EXPECT !printer-uri-supported
	# EXPECT !printer-uuid
	# EXPECT !pwg-raster-document-resolution-supported
	# EXPECT !pwg-raster-document-sheet-back
	# EXPECT !pwg-raster-document-type-supported
	# EXPECT !queued-job-count
	# EXPECT !uri-authentication-supported
	# EXPECT !uri-security-supported
	# EXPECT !which-jobs-supported

	# 'job-template' attributes
	EXPECT copies-default
	EXPECT copies-supported
	EXPECT finishings-default IF-DEFINED HAVE_FINISHINGS
	EXPECT finishings-supported IF-DEFINED HAVE_FINISHINGS
	EXPECT media-bottom-margin-supported
	EXPECT media-col-default
	EXPECT media-col-ready
	EXPECT media-col-supported
	EXPECT media-default
	EXPECT media-left-margin-supported
	EXPECT media-ready
	EXPECT media-right-margin-supported
	EXPECT media-size-supported
	EXPECT media-source-supported IF-DEFINED HAVE_MEDIA_SOURCE
	EXPECT media-supported
	EXPECT media-top-margin-supported
	EXPECT media-type-supported IF-DEFINED HAVE_MEDIA_TYPE
	EXPECT orientation-requested-default
	EXPECT orientation-requested-supported
	EXPECT output-bin-default
	EXPECT output-bin-supported
	EXPECT overrides-supported IF-DEFINED HAVE_PDF
	EXPECT page-ranges-supported IF-DEFINED HAVE_PDF
	EXPECT print-color-mode-default
	EXPECT print-color-mode-supported
	EXPECT print-content-optimize-default IF-DEFINED HAVE_PRINT_CONTENT_OPTIMIZE
	EXPECT print-content-optimize-supported IF-DEFINED HAVE_PRINT_CONTENT_OPTIMIZE
	EXPECT print-quality-default
	EXPECT print-quality-supported
	EXPECT print-rendering-intent-default IF-DEFINED HAVE_ICC_PROFILES
	EXPECT print-rendering-intent-supported IF-DEFINED HAVE_ICC_PROFILES
	EXPECT printer-resolution-default
	EXPECT printer-resolution-supported
	EXPECT sides-default IF-DEFINED HAVE_DUPLEX
	EXPECT sides-supported IF-DEFINED HAVE_DUPLEX
}


# Test Get-Printer-Attributes operation with requested-attributes
#
# Required by: RFC 8011 section 4.2.5, PWG 5100.11 (JPS2)
{
	NAME "I-10.7 Get-Printer-Attributes Operation (media-col-database, printer-uri-supported)"
	OPERATION Get-Printer-Attributes
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR keyword requested-attributes media-col-database,printer-uri-supported

	STATUS successful-ok

	EXPECT media-col-database OF-TYPE collection IN-GROUP printer-attributes-tag
	EXPECT-ALL media-col-database/media-size OF-TYPE collection COUNT 1
	EXPECT-ALL media-col-database/media-size/x-dimension OF-TYPE integer COUNT 1 WITH-VALUE >0
	EXPECT-ALL media-col-database/media-size/y-dimension OF-TYPE integer COUNT 1 WITH-VALUE >0
	EXPECT-ALL ?media-col-database/media-source OF-TYPE keyword|name COUNT 1 IF-DEFINED HAVE_MEDIA_SOURCE
	EXPECT-ALL ?media-col-database/media-source-properties OF-TYPE collection COUNT 1
	EXPECT-ALL ?media-col-database/media-type OF-TYPE keyword|name COUNT 1 IF-DEFINED HAVE_MEDIA_TYPE

	EXPECT printer-uri-supported OF-TYPE uri IN-GROUP printer-attributes-tag WITH-ALL-VALUES "$IPP_URI_SCHEME"

	## Issue #50: Relax Get-Printer-Attributes tests
	# EXPECT !printer-name
	# EXPECT !printer-state
	# EXPECT !printer-state-message
	# EXPECT !printer-state-reasons
}


# Test Validate-Job operation
#
# Required by: RFC 8011 section 4.2.3
{
	NAME "I-11. Validate-Job Operation"
	OPERATION Validate-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR name job-name "Validate Job Test"
	ATTR boolean ipp-attribute-fidelity false
	ATTR name document-name "Validate Document Test"
	ATTR keyword compression none
	ATTR mimeMediaType document-format "image/pwg-raster"

	GROUP job-attributes-tag
	ATTR keyword media "$DEFAULT_MEDIA"
	ATTR keyword print-color-mode "$DEFAULT_PRINT_COLOR_MODE"
	ATTR enum print-quality $DEFAULT_PRINT_QUALITY
	ATTR resolution printer-resolution $DEFAULT_PRINTER_RESOLUTION
	ATTR keyword sides "one-sided"

	STATUS successful-ok
}


# Test Print-Job operation
#
# Required by: RFC 8011 section 4.2.1
{
	SKIP-IF-NOT-DEFINED HAVE_BLACK
	SKIP-IF-DEFINED HAVE_SGRAY
	SKIP-IF-DEFINED HAVE_SRGB

	NAME "I-12. Print-Job Operation (Print-Job onepage-letter.pwg)"
	OPERATION Print-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR name job-name "Print-Job Test"
	ATTR boolean ipp-attribute-fidelity false
	ATTR name document-name "Print-Job Document"
	ATTR keyword compression none
	ATTR mimeMediaType document-format "image/pwg-raster"

	GROUP job-attributes-tag
	ATTR keyword media "$DEFAULT_MEDIA"
	ATTR keyword print-color-mode "$DEFAULT_PRINT_COLOR_MODE"
	ATTR enum print-quality $DEFAULT_PRINT_QUALITY
	ATTR resolution printer-resolution $DEFAULT_PRINTER_RESOLUTION
	ATTR keyword sides "one-sided"

	FILE "pwg-raster-samples-$RASTER_RESOLUTION/black-1/onepage-letter-black-1-$RASTER_RESOLUTION.pwg"

	STATUS successful-ok
	STATUS server-error-job-canceled
	STATUS server-error-busy REPEAT-MATCH REPEAT-LIMIT 30

	EXPECT job-uri OF-TYPE uri COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE "$IPP_URI_SCHEME"

	EXPECT job-id OF-TYPE integer COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE >0
	EXPECT job-id DEFINE-VALUE PRINT_JOB_ID

	EXPECT job-state OF-TYPE unknown|enum COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE 3,4,5,6,7,8,9
	EXPECT job-state WITH-VALUE 7,8,9 DEFINE-MATCH PRINT_JOB_COMPLETED

	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag

	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
}
{
	SKIP-IF-NOT-DEFINED HAVE_SGRAY
	SKIP-IF-DEFINED HAVE_SRGB

	NAME "I-12. Print-Job Operation (Print-Job onepage-letter.pwg)"
	OPERATION Print-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR name job-name "Print-Job Test"
	ATTR boolean ipp-attribute-fidelity false
	ATTR name document-name "Print-Job Document"
	ATTR keyword compression none
	ATTR mimeMediaType document-format "image/pwg-raster"

	GROUP job-attributes-tag
	ATTR keyword media "$DEFAULT_MEDIA"
	ATTR keyword print-color-mode "$DEFAULT_PRINT_COLOR_MODE"
	ATTR enum print-quality $DEFAULT_PRINT_QUALITY
	ATTR resolution printer-resolution $DEFAULT_PRINTER_RESOLUTION
	ATTR keyword sides "one-sided"

	FILE "pwg-raster-samples-$RASTER_RESOLUTION/sgray-8/onepage-letter-sgray-8-$RASTER_RESOLUTION.pwg"

	STATUS successful-ok
	STATUS server-error-job-canceled
	STATUS server-error-busy REPEAT-MATCH REPEAT-LIMIT 30

	EXPECT job-uri OF-TYPE uri COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE "$IPP_URI_SCHEME"

	EXPECT job-id OF-TYPE integer COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE >0
	EXPECT job-id DEFINE-VALUE PRINT_JOB_ID

	EXPECT job-state OF-TYPE unknown|enum COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE 3,4,5,6,7,8,9
	EXPECT job-state WITH-VALUE 7,8,9 DEFINE-MATCH PRINT_JOB_COMPLETED

	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag

	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
}
{
	SKIP-IF-NOT-DEFINED HAVE_SRGB

	NAME "I-12. Print-Job Operation (Print-Job onepage-letter.pwg)"
	OPERATION Print-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR name job-name "Print-Job Test"
	ATTR boolean ipp-attribute-fidelity false
	ATTR name document-name "Print-Job Document"
	ATTR keyword compression none
	ATTR mimeMediaType document-format "image/pwg-raster"

	GROUP job-attributes-tag
	ATTR keyword media "$DEFAULT_MEDIA"
	ATTR keyword print-color-mode "$DEFAULT_PRINT_COLOR_MODE"
	ATTR enum print-quality $DEFAULT_PRINT_QUALITY
	ATTR resolution printer-resolution $DEFAULT_PRINTER_RESOLUTION
	ATTR keyword sides "one-sided"

	FILE "pwg-raster-samples-$RASTER_RESOLUTION/srgb-8/onepage-letter-srgb-8-$RASTER_RESOLUTION.pwg"

	STATUS successful-ok
	STATUS server-error-job-canceled
	STATUS server-error-busy REPEAT-MATCH REPEAT-LIMIT 30

	EXPECT job-uri OF-TYPE uri COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE "$IPP_URI_SCHEME"

	EXPECT job-id OF-TYPE integer COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE >0
	EXPECT job-id DEFINE-VALUE PRINT_JOB_ID

	EXPECT job-state OF-TYPE unknown|enum COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE 3,4,5,6,7,8,9
	EXPECT job-state WITH-VALUE 7,8,9 DEFINE-MATCH PRINT_JOB_COMPLETED

	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag

	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
}


# Test Get-Jobs operation
#
# Required by: RFC 8011 section 4.2.6
{
	SKIP-IF-DEFINED PRINT_JOB_COMPLETED

	NAME "I-13. Get-Jobs Operation (default)"
	OPERATION Get-Jobs
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user

	STATUS successful-ok

	EXPECT ?job-id OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >0
	EXPECT ?job-uri OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$IPP_URI_SCHEME"
	EXPECT !job-name
	EXPECT !job-state
}


# Test Get-Jobs operation
#
# Required by: RFC 8011 section 4.2.6
{
	SKIP-IF-DEFINED PRINT_JOB_COMPLETED

	NAME "I-13.1 Get-Jobs Operation (requested-attributes)"
	OPERATION Get-Jobs
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR keyword requested-attributes all

	STATUS successful-ok

	# PWG 5100.14 - Table 9 - Job Description attributes
	EXPECT date-time-at-completed OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT date-time-at-creation OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT date-time-at-processing OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-id OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >0
	EXPECT job-impressions OF-TYPE integer|no-value IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-impressions-completed OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-name OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-originating-user-name OF-TYPE name IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$user"
	EXPECT job-printer-up-time OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-printer-uri OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$uri"
	EXPECT job-state OF-TYPE unknown|enum IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >2,<7
	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
	EXPECT job-uri OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$IPP_URI_SCHEME"
	EXPECT job-uuid OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$UUID_URI"
	EXPECT time-at-completed OF-TYPE no-value|integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT time-at-creation OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT time-at-processing OF-TYPE no-value|integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1

	# PWG 5100.15 - Table 8 - Job Template attributes
	EXPECT ?copies OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?feed-orientation OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?finishings OF-TYPE enum IN-GROUP job-attributes-tag
	EXPECT ?job-account-id OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?job-accounting-user-id OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?media OF-TYPE keyword|name IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?media-col OF-TYPE collection IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?multiple-document-handling OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?orientation-requested OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?output-bin OF-TYPE keyword|name IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?page-ranges OF-TYPE rangeOfInteger IN-GROUP job-attributes-tag
	EXPECT ?print-color-mode OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?print-quality OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?printer-resolution OF-TYPE resolution IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?sides OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1
}


# Test Get-Jobs operation
#
# Required by: RFC 8011 section 4.2.6
{
	SKIP-IF-DEFINED PRINT_JOB_COMPLETED

	NAME "I-13.2 Get-Jobs Operation (which-jobs=not-completed)"
	OPERATION Get-Jobs
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR keyword which-jobs not-completed

	STATUS successful-ok

	EXPECT ?job-id OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >0
	EXPECT ?job-uri OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$IPP_URI_SCHEME"
	EXPECT !job-name
	EXPECT !job-state
}


# Wait for job to complete...
{
	SKIP-IF-NOT-DEFINED PRINT_JOB_ID

	NAME "I-14. Get-Job-Attributes Operation (until job complete)"
	OPERATION Get-Job-Attributes
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR integer job-id $PRINT_JOB_ID
	ATTR name requesting-user-name $user

	STATUS successful-ok
	EXPECT job-state OF-TYPE unknown|enum IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >6 REPEAT-NO-MATCH REPEAT-LIMIT 30
	DISPLAY job-state

	# PWG 5100.14 - Table 9 - Job Description attributes
	EXPECT date-time-at-completed OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT date-time-at-creation OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT date-time-at-processing OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-id OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE $PRINT_JOB_ID
	EXPECT job-impressions OF-TYPE integer|no-value IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-impressions-completed OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-name OF-TYPE name IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "Print-Job Test"
	EXPECT job-originating-user-name OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-printer-up-time OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-printer-uri OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$uri"
	EXPECT job-state OF-TYPE unknown|enum IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >2,<10
	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
	EXPECT job-uri OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$IPP_URI_SCHEME"
	EXPECT job-uuid OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$UUID_URI"
	EXPECT time-at-completed OF-TYPE no-value|integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT time-at-creation OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT time-at-processing OF-TYPE no-value|integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1

	# PWG 5100.15 - Table 8 - Job Template attributes
	EXPECT ?copies OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "1"
	EXPECT ?feed-orientation OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?finishings OF-TYPE enum IN-GROUP job-attributes-tag
	EXPECT ?job-account-id OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?job-accounting-user-id OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT media OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$DEFAULT_MEDIA"
	EXPECT ?media-col OF-TYPE collection IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?multiple-document-handling OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?orientation-requested OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?output-bin OF-TYPE keyword|name IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$DEFAULT_OUTPUT_BIN"
	EXPECT !page-ranges
	EXPECT print-color-mode OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$DEFAULT_PRINT_COLOR_MODE"
	EXPECT print-quality OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE $DEFAULT_PRINT_QUALITY
	EXPECT printer-resolution OF-TYPE resolution IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$DEFAULT_PRINTER_RESOLUTION"
	EXPECT sides OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "one-sided"
}


# Test Get-Jobs operation
#
# Required by: RFC 8011 section 4.2.6
{
	NAME "I-15. Get-Jobs Operation (which-jobs=completed)"
	OPERATION Get-Jobs
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR keyword which-jobs completed

	STATUS successful-ok

	# TODO: Use EXPECT-ALL/ANY syntax to check for job that was just completed
	EXPECT job-id OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >0
	EXPECT job-uri OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$IPP_URI_SCHEME"
	EXPECT !job-name
	EXPECT !job-state
}


# Test Get-Jobs operation
#
# Required by: RFC 8011 section 4.2.6
{
	NAME "I-15.1 Get-Jobs Operation (which-jobs, requested-attributes)"
	OPERATION Get-Jobs
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR keyword requested-attributes all
	ATTR keyword which-jobs completed

	STATUS successful-ok

	# PWG 5100.14 - Table 9 - Job Description attributes
	EXPECT date-time-at-completed OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT date-time-at-creation OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT date-time-at-processing OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-id OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-impressions OF-TYPE integer|no-value IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-impressions-completed OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-name OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-originating-user-name OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-printer-up-time OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-printer-uri OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$uri"
	EXPECT job-state OF-TYPE unknown|enum IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >6,<10
	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
	EXPECT job-uri OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$IPP_URI_SCHEME"
	EXPECT job-uuid OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$UUID_URI"
	EXPECT time-at-completed OF-TYPE no-value|integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT time-at-creation OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT time-at-processing OF-TYPE no-value|integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1

	# PWG 5100.15 - Table 8 - Job Template attributes
	EXPECT ?copies OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?feed-orientation OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?finishings OF-TYPE enum IN-GROUP job-attributes-tag
	EXPECT ?job-account-id OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?job-accounting-user-id OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?media OF-TYPE keyword|name IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?media-col OF-TYPE collection IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?multiple-document-handling OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?orientation-requested OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?output-bin OF-TYPE keyword|name IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?page-ranges OF-TYPE rangeOfInteger IN-GROUP job-attributes-tag
	EXPECT ?print-color-mode OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?print-quality OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?printer-resolution OF-TYPE resolution IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?sides OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1
}


# Test Cancel-Job operation
#
# Required by: RFC 8011 section 4.3.3
{
	NAME "I-16. Cancel-Job Operation (completed job)"
	OPERATION Cancel-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR integer job-id $PRINT_JOB_ID
	ATTR name requesting-user-name $user

	STATUS client-error-not-possible
}


# Test Print-Job operation
#
# Required by: RFC 8011 section 4.2.1
{
	SKIP-IF-NOT-DEFINED HAVE_BLACK
	SKIP-IF-DEFINED HAVE_SGRAY
	SKIP-IF-DEFINED HAVE_SRGB

	NAME "I-16.1 Cancel-Job Operation (Print-Job onepage-letter.pwg)"
	OPERATION Print-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR name job-name "Cancel-Job Test"
	ATTR boolean ipp-attribute-fidelity false
	ATTR name document-name "Cancel-Job Document"
	ATTR keyword compression none
	ATTR mimeMediaType document-format "image/pwg-raster"

	GROUP job-attributes-tag
	ATTR keyword media "$DEFAULT_MEDIA"
	ATTR keyword print-color-mode "$DEFAULT_PRINT_COLOR_MODE"
	ATTR enum print-quality $DEFAULT_PRINT_QUALITY
	ATTR resolution printer-resolution $DEFAULT_PRINTER_RESOLUTION
	ATTR keyword sides "one-sided"

	FILE "pwg-raster-samples-$RASTER_RESOLUTION/black-1/onepage-letter-black-1-$RASTER_RESOLUTION.pwg"

	STATUS successful-ok
	STATUS server-error-job-canceled
	STATUS server-error-busy REPEAT-MATCH REPEAT-LIMIT 30

	EXPECT job-uri OF-TYPE uri COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE "$IPP_URI_SCHEME"

	EXPECT job-id OF-TYPE integer COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE >0
	EXPECT job-id DEFINE-VALUE CANCEL_JOB_ID

	EXPECT job-state OF-TYPE unknown|enum COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE 3,4,5,6,7,8,9

	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag

	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
}
{
	SKIP-IF-NOT-DEFINED HAVE_SGRAY
	SKIP-IF-DEFINED HAVE_SRGB

	NAME "I-16.1 Cancel-Job Operation (Print-Job onepage-letter.pwg)"
	OPERATION Print-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR name job-name "Cancel-Job Test"
	ATTR boolean ipp-attribute-fidelity false
	ATTR name document-name "Cancel-Job Document"
	ATTR keyword compression none
	ATTR mimeMediaType document-format "image/pwg-raster"

	GROUP job-attributes-tag
	ATTR keyword media "$DEFAULT_MEDIA"
	ATTR keyword print-color-mode "$DEFAULT_PRINT_COLOR_MODE"
	ATTR enum print-quality $DEFAULT_PRINT_QUALITY
	ATTR resolution printer-resolution $DEFAULT_PRINTER_RESOLUTION
	ATTR keyword sides "one-sided"

	FILE "pwg-raster-samples-$RASTER_RESOLUTION/sgray-8/onepage-letter-sgray-8-$RASTER_RESOLUTION.pwg"

	STATUS successful-ok
	STATUS server-error-job-canceled
	STATUS server-error-busy REPEAT-MATCH REPEAT-LIMIT 30

	EXPECT job-uri OF-TYPE uri COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE "$IPP_URI_SCHEME"

	EXPECT job-id OF-TYPE integer COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE >0
	EXPECT job-id DEFINE-VALUE CANCEL_JOB_ID

	EXPECT job-state OF-TYPE unknown|enum COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE 3,4,5,6,7,8,9

	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag

	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
}
{
	SKIP-IF-NOT-DEFINED HAVE_SRGB

	NAME "I-16.1 Cancel-Job Operation (Print-Job onepage-letter.pwg)"
	OPERATION Print-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR name job-name "Cancel-Job Test"
	ATTR boolean ipp-attribute-fidelity false
	ATTR name document-name "Cancel-Job Document"
	ATTR keyword compression none
	ATTR mimeMediaType document-format "image/pwg-raster"

	GROUP job-attributes-tag
	ATTR keyword media "$DEFAULT_MEDIA"
	ATTR keyword print-color-mode "$DEFAULT_PRINT_COLOR_MODE"
	ATTR enum print-quality $DEFAULT_PRINT_QUALITY
	ATTR resolution printer-resolution $DEFAULT_PRINTER_RESOLUTION
	ATTR keyword sides "one-sided"

	FILE "pwg-raster-samples-$RASTER_RESOLUTION/srgb-8/onepage-letter-srgb-8-$RASTER_RESOLUTION.pwg"

	STATUS successful-ok
	STATUS server-error-job-canceled
	STATUS server-error-busy REPEAT-MATCH REPEAT-LIMIT 30

	EXPECT job-uri OF-TYPE uri COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE "$IPP_URI_SCHEME"

	EXPECT job-id OF-TYPE integer COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE >0
	EXPECT job-id DEFINE-VALUE CANCEL_JOB_ID

	EXPECT job-state OF-TYPE unknown|enum COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE 3,4,5,6,7,8,9

	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag

	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
}


# Test Cancel-Job operation
#
# Required by: RFC 8011 section 4.3.3
{
	NAME "I-16.2. Cancel-Job Operation (pending/processing job)"
	OPERATION Cancel-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR integer job-id $CANCEL_JOB_ID
	ATTR name requesting-user-name $user

	STATUS successful-ok
	STATUS client-error-not-possible
}


# Test Get-Job-Attributes operation
#
# Required by: RFC 8011 section 4.3.4
{
	NAME "I-16.3 Cancel-Job Operations (Get-Job-Attributes)"
	OPERATION Get-Job-Attributes
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR integer job-id $CANCEL_JOB_ID
	ATTR name requesting-user-name $user

	STATUS successful-ok

	# PWG 5100.14 - Table 9 - Job Description attributes
	EXPECT date-time-at-completed OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT date-time-at-creation OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT date-time-at-processing OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-id OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE $CANCEL_JOB_ID
	EXPECT job-impressions OF-TYPE integer|no-value IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-impressions-completed OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-name OF-TYPE name IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "Cancel-Job Test"
	EXPECT job-originating-user-name OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-printer-up-time OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-printer-uri OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$uri"
	EXPECT job-state OF-TYPE unknown|enum IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >6,<10
	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
	EXPECT job-uri OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$IPP_URI_SCHEME"
	EXPECT job-uuid OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$UUID_URI"
	EXPECT time-at-completed OF-TYPE no-value|integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT time-at-creation OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT time-at-processing OF-TYPE no-value|integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1

	# PWG 5100.15 - Table 8 - Job Template attributes
	EXPECT ?copies OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "1"
	EXPECT ?feed-orientation OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?finishings OF-TYPE enum IN-GROUP job-attributes-tag
	EXPECT ?job-account-id OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?job-accounting-user-id OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT media OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$DEFAULT_MEDIA"
	EXPECT ?media-col OF-TYPE collection IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?multiple-document-handling OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?orientation-requested OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?output-bin OF-TYPE keyword|name IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$DEFAULT_OUTPUT_BIN"
	EXPECT !page-ranges
	EXPECT print-color-mode OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$DEFAULT_PRINT_COLOR_MODE"
	EXPECT print-quality OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE $DEFAULT_PRINT_QUALITY
	EXPECT printer-resolution OF-TYPE resolution IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$DEFAULT_PRINTER_RESOLUTION"
	EXPECT sides OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "one-sided"
}


# Test Cancel-My-Jobs operation
#
# Required by: IPP Everywhere
{
	SKIP-IF-NOT-DEFINED HAVE_BLACK
	SKIP-IF-DEFINED HAVE_SGRAY
	SKIP-IF-DEFINED HAVE_SRGB

	NAME "I-17. Cancel-My-Jobs Operation (Print-Job onepage-letter.pwg)"
	OPERATION Print-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR name job-name "Cancel-My-Jobs Test"
	ATTR boolean ipp-attribute-fidelity false
	ATTR name document-name "Cancel-My-Jobs Document"
	ATTR keyword compression none
	ATTR mimeMediaType document-format "image/pwg-raster"

	GROUP job-attributes-tag
	ATTR keyword media "$DEFAULT_MEDIA"
	ATTR keyword print-color-mode "$DEFAULT_PRINT_COLOR_MODE"
	ATTR enum print-quality $DEFAULT_PRINT_QUALITY
	ATTR resolution printer-resolution $DEFAULT_PRINTER_RESOLUTION
	ATTR keyword sides "one-sided"

	FILE "pwg-raster-samples-$RASTER_RESOLUTION/black-1/onepage-letter-black-1-$RASTER_RESOLUTION.pwg"

	STATUS successful-ok
	STATUS server-error-job-canceled
	STATUS server-error-busy REPEAT-MATCH REPEAT-LIMIT 30

	EXPECT job-uri OF-TYPE uri COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE "$IPP_URI_SCHEME"

	EXPECT job-id OF-TYPE integer COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE >0
	EXPECT job-id DEFINE-VALUE CANCEL_MY_JOBS_ID

	EXPECT job-state OF-TYPE unknown|enum COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE 3,4,5,6,7,8,9

	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag

	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
}
{
	SKIP-IF-NOT-DEFINED HAVE_SGRAY
	SKIP-IF-DEFINED HAVE_SRGB

	NAME "I-17. Cancel-My-Jobs Operation (Print-Job onepage-letter.pwg)"
	OPERATION Print-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR name job-name "Cancel-My-Jobs Test"
	ATTR boolean ipp-attribute-fidelity false
	ATTR name document-name "Cancel-My-Jobs Document"
	ATTR keyword compression none
	ATTR mimeMediaType document-format "image/pwg-raster"

	GROUP job-attributes-tag
	ATTR keyword media "$DEFAULT_MEDIA"
	ATTR keyword print-color-mode "$DEFAULT_PRINT_COLOR_MODE"
	ATTR enum print-quality $DEFAULT_PRINT_QUALITY
	ATTR resolution printer-resolution $DEFAULT_PRINTER_RESOLUTION
	ATTR keyword sides "one-sided"

	FILE "pwg-raster-samples-$RASTER_RESOLUTION/sgray-8/onepage-letter-sgray-8-$RASTER_RESOLUTION.pwg"

	STATUS successful-ok
	STATUS server-error-job-canceled
	STATUS server-error-busy REPEAT-MATCH REPEAT-LIMIT 30

	EXPECT job-uri OF-TYPE uri COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE "$IPP_URI_SCHEME"

	EXPECT job-id OF-TYPE integer COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE >0
	EXPECT job-id DEFINE-VALUE CANCEL_MY_JOBS_ID

	EXPECT job-state OF-TYPE unknown|enum COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE 3,4,5,6,7,8,9

	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag

	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
}
{
	SKIP-IF-NOT-DEFINED HAVE_SRGB

	NAME "I-17. Cancel-My-Jobs Operation (Print-Job onepage-letter.pwg)"
	OPERATION Print-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR name job-name "Cancel-My-Jobs Test"
	ATTR boolean ipp-attribute-fidelity false
	ATTR name document-name "Cancel-My-Jobs Document"
	ATTR keyword compression none
	ATTR mimeMediaType document-format "image/pwg-raster"

	GROUP job-attributes-tag
	ATTR keyword media "$DEFAULT_MEDIA"
	ATTR keyword print-color-mode "$DEFAULT_PRINT_COLOR_MODE"
	ATTR enum print-quality $DEFAULT_PRINT_QUALITY
	ATTR resolution printer-resolution $DEFAULT_PRINTER_RESOLUTION
	ATTR keyword sides "one-sided"

	FILE "pwg-raster-samples-$RASTER_RESOLUTION/srgb-8/onepage-letter-srgb-8-$RASTER_RESOLUTION.pwg"

	STATUS successful-ok
	STATUS server-error-job-canceled
	STATUS server-error-busy REPEAT-MATCH REPEAT-LIMIT 30

	EXPECT job-uri OF-TYPE uri COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE "$IPP_URI_SCHEME"

	EXPECT job-id OF-TYPE integer COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE >0
	EXPECT job-id DEFINE-VALUE CANCEL_MY_JOBS_ID

	EXPECT job-state OF-TYPE unknown|enum COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE 3,4,5,6,7,8,9

	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag

	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
}

{
	NAME "I-17.1 Cancel-My-Jobs Operation (Cancel-My-Jobs)"
	OPERATION Cancel-My-Jobs
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user

	STATUS successful-ok
	STATUS client-error-not-possible
}

{
	NAME "I-17.2 Cancel-My-Jobs Operations (Get-Job-Attributes)"
	OPERATION Get-Job-Attributes
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR integer job-id $CANCEL_MY_JOBS_ID
	ATTR name requesting-user-name $user

	STATUS successful-ok

	# PWG 5100.14 - Table 9 - Job Description attributes
	EXPECT date-time-at-completed OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT date-time-at-creation OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT date-time-at-processing OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-id OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE $CANCEL_MY_JOBS_ID
	EXPECT job-impressions OF-TYPE integer|no-value IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-impressions-completed OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-name OF-TYPE name IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "Cancel-My-Jobs Test"
	EXPECT job-originating-user-name OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-printer-up-time OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-printer-uri OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$uri"
	EXPECT job-state OF-TYPE unknown|enum IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >6,<10
	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
	EXPECT job-uri OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$IPP_URI_SCHEME"
	EXPECT job-uuid OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$UUID_URI"
	EXPECT time-at-completed OF-TYPE no-value|integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT time-at-creation OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT time-at-processing OF-TYPE no-value|integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1

	# PWG 5100.15 - Table 8 - Job Template attributes
	EXPECT ?copies OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "1"
	EXPECT ?feed-orientation OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?finishings OF-TYPE enum IN-GROUP job-attributes-tag
	EXPECT ?job-account-id OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?job-accounting-user-id OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT media OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$DEFAULT_MEDIA"
	EXPECT ?media-col OF-TYPE collection IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?multiple-document-handling OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?orientation-requested OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?output-bin OF-TYPE keyword|name IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$DEFAULT_OUTPUT_BIN"
	EXPECT !page-ranges
	EXPECT print-color-mode OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$DEFAULT_PRINT_COLOR_MODE"
	EXPECT print-quality OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE $DEFAULT_PRINT_QUALITY
	EXPECT printer-resolution OF-TYPE resolution IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$DEFAULT_PRINTER_RESOLUTION"
	EXPECT sides OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "one-sided"
}


# Test Create-Job and Send-Document operations
#
# Defined by: RFC 8011 section 4.2.4 and 4.3.1
{
	NAME "I-18. Create-Job + Send-Document Operations (Create-Job)"
	OPERATION Create-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR name job-name "Create-Job + Send-Document Test"
	ATTR boolean ipp-attribute-fidelity false

	GROUP job-attributes-tag
	ATTR keyword media "$DEFAULT_MEDIA"
	ATTR keyword print-color-mode "$DEFAULT_PRINT_COLOR_MODE"
	ATTR enum print-quality $DEFAULT_PRINT_QUALITY
	ATTR resolution printer-resolution $DEFAULT_PRINTER_RESOLUTION
	ATTR keyword sides "one-sided"

	STATUS successful-ok
	STATUS server-error-job-canceled
	STATUS server-error-busy REPEAT-MATCH REPEAT-LIMIT 30

	EXPECT job-uri OF-TYPE uri COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE "$IPP_URI_SCHEME"

	EXPECT job-id OF-TYPE integer COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE >0
	EXPECT job-id DEFINE-VALUE CREATE_SEND_ID

	EXPECT job-state OF-TYPE unknown|enum COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE 3,4,5,6

	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag

	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
}

{
	SKIP-IF-NOT-DEFINED CREATE_SEND_ID
	SKIP-IF-NOT-DEFINED HAVE_BLACK
	SKIP-IF-DEFINED HAVE_SGRAY
	SKIP-IF-DEFINED HAVE_SRGB

	NAME "I-18.1 Create-Job + Send-Document Operations (Send-Document onepage-letter.pwg)"
	OPERATION Send-Document
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR integer job-id $CREATE_SEND_ID
	ATTR name requesting-user-name $user
	ATTR boolean last-document true
	ATTR name document-name "Create-Job + Send-Document Document"
	ATTR keyword compression none
	ATTR mimeMediaType document-format "image/pwg-raster"

	FILE "pwg-raster-samples-$RASTER_RESOLUTION/black-1/onepage-letter-black-1-$RASTER_RESOLUTION.pwg"

	STATUS successful-ok
	STATUS server-error-job-canceled
}
{
	SKIP-IF-NOT-DEFINED CREATE_SEND_ID
	SKIP-IF-NOT-DEFINED HAVE_SGRAY
	SKIP-IF-DEFINED HAVE_SRGB

	NAME "I-18.1 Create-Job + Send-Document Operations (Send-Document onepage-letter.pwg)"
	OPERATION Send-Document
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR integer job-id $CREATE_SEND_ID
	ATTR name requesting-user-name $user
	ATTR boolean last-document true
	ATTR name document-name "Create-Job + Send-Document Document"
	ATTR keyword compression none
	ATTR mimeMediaType document-format "image/pwg-raster"

	FILE "pwg-raster-samples-$RASTER_RESOLUTION/sgray-8/onepage-letter-sgray-8-$RASTER_RESOLUTION.pwg"

	STATUS successful-ok
	STATUS server-error-job-canceled
}
{
	SKIP-IF-NOT-DEFINED CREATE_SEND_ID
	SKIP-IF-NOT-DEFINED HAVE_SRGB

	NAME "I-18.1 Create-Job + Send-Document Operations (Send-Document onepage-letter.pwg)"
	OPERATION Send-Document
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR integer job-id $CREATE_SEND_ID
	ATTR name requesting-user-name $user
	ATTR boolean last-document true
	ATTR name document-name "Create-Job + Send-Document Document"
	ATTR keyword compression none
	ATTR mimeMediaType document-format "image/pwg-raster"

	FILE "pwg-raster-samples-$RASTER_RESOLUTION/srgb-8/onepage-letter-srgb-8-$RASTER_RESOLUTION.pwg"

	STATUS successful-ok
	STATUS server-error-job-canceled
}

# Wait for job to complete...
{
	SKIP-IF-NOT-DEFINED CREATE_SEND_ID

	NAME "I-18.2 Create-Job + Send-Document Operations (Get-Job-Attributes until job complete)"
	OPERATION Get-Job-Attributes
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR integer job-id $CREATE_SEND_ID
	ATTR name requesting-user-name $user

	STATUS successful-ok
	EXPECT job-state OF-TYPE unknown|enum IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-state WITH-VALUE >6 REPEAT-NO-MATCH REPEAT-LIMIT 30
	DISPLAY job-state

	# PWG 5100.14 - Table 9 - Job Description attributes
	EXPECT date-time-at-completed OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT date-time-at-creation OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT date-time-at-processing OF-TYPE dateTime|no-value|unknown IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-id OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE $CREATE_SEND_ID
	EXPECT job-impressions OF-TYPE integer|no-value IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-impressions-completed OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-name OF-TYPE name IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "Create-Job + Send-Document Test"
	EXPECT job-originating-user-name OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-printer-up-time OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT job-printer-uri OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$uri"
	EXPECT job-state OF-TYPE unknown|enum IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >2,<10
	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag COUNT 1
	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
	EXPECT job-uri OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$IPP_URI_SCHEME"
	EXPECT job-uuid OF-TYPE uri IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$UUID_URI"
	EXPECT time-at-completed OF-TYPE no-value|integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT time-at-creation OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1
	EXPECT time-at-processing OF-TYPE no-value|integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE >-1

	# PWG 5100.15 - Table 8 - Job Template attributes
	EXPECT ?copies OF-TYPE integer IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "1"
	EXPECT ?feed-orientation OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?finishings OF-TYPE enum IN-GROUP job-attributes-tag
	EXPECT ?job-account-id OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?job-accounting-user-id OF-TYPE name IN-GROUP job-attributes-tag COUNT 1
	EXPECT media OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$DEFAULT_MEDIA"
	EXPECT ?media-col OF-TYPE collection IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?multiple-document-handling OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?orientation-requested OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1
	EXPECT ?output-bin OF-TYPE keyword|name IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$DEFAULT_OUTPUT_BIN"
	EXPECT !page-ranges
	EXPECT print-color-mode OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$DEFAULT_PRINT_COLOR_MODE"
	EXPECT print-quality OF-TYPE enum IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE $DEFAULT_PRINT_QUALITY
	EXPECT printer-resolution OF-TYPE resolution IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "$DEFAULT_PRINTER_RESOLUTION"
	EXPECT sides OF-TYPE keyword IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "one-sided"
}


# Test Close-Job operation
#
# Create an empty job using Create-Job and Close-Job operations, and then
# cancel the job to clean it up.
{
	NAME "I-19. Close-Job Test (Create-Job Operation)"

	OPERATION Create-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR name job-name "Close-Job Test Job"
	ATTR boolean ipp-attribute-fidelity false

	STATUS successful-ok
	STATUS server-error-job-canceled
	STATUS server-error-busy REPEAT-MATCH REPEAT-LIMIT 30

	EXPECT job-uri OF-TYPE uri COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE "$IPP_URI_SCHEME"
	EXPECT job-id OF-TYPE integer COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE >0
	EXPECT job-id DEFINE-VALUE CLOSE_JOB_ID
	EXPECT job-state OF-TYPE unknown|enum COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE 3,4,5,6
	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag
	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
}

{
	SKIP-IF-NOT-DEFINED CLOSE_JOB_ID

	NAME "I-19.1 Close-Job Test (Close-Job Operation)"
	OPERATION Close-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR integer job-id $CLOSE_JOB_ID
	ATTR name requesting-user-name $user

	STATUS successful-ok
	STATUS server-error-job-canceled
}

{
	SKIP-IF-NOT-DEFINED CLOSE_JOB_ID

	NAME "I-19.2 Close-Job Test (Get-Job-Attributes Operation)"
	OPERATION Get-Job-Attributes
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR integer job-id $CLOSE_JOB_ID
	ATTR name requesting-user-name $user

	STATUS successful-ok
	EXPECT job-name OF-TYPE name IN-GROUP job-attributes-tag COUNT 1 WITH-VALUE "Close-Job Test Job"
}

{
	SKIP-IF-NOT-DEFINED CLOSE_JOB_ID

	NAME "I-19.3. Close-Job Test (Cancel-Job Operation)"
	OPERATION Cancel-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR integer job-id $CLOSE_JOB_ID
	ATTR name requesting-user-name $user

	STATUS successful-ok
	STATUS client-error-not-possible
}


# Test Print-Job operation for media-needed
#
# Required by: RFC 8011 section 4.2.1
{
	SKIP-IF-DEFINED IPP_EVERYWHERE_SERVER
	SKIP-IF-NOT-DEFINED HAVE_BLACK
	SKIP-IF-DEFINED HAVE_SGRAY
	SKIP-IF-DEFINED HAVE_SRGB

	PAUSE "Remove media from printer until this test run is complete."

	NAME "I-20. media-needed (Print-Job onepage-letter.pwg)"
	OPERATION Print-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR name job-name "media-needed Test"
	ATTR boolean ipp-attribute-fidelity false
	ATTR name document-name "media-needed Document"
	ATTR keyword compression none
	ATTR mimeMediaType document-format "image/pwg-raster"

	GROUP job-attributes-tag
	ATTR keyword media "$DEFAULT_MEDIA"
	ATTR keyword print-color-mode "$DEFAULT_PRINT_COLOR_MODE"
	ATTR enum print-quality $DEFAULT_PRINT_QUALITY
	ATTR resolution printer-resolution $DEFAULT_PRINTER_RESOLUTION
	ATTR keyword sides "one-sided"

	FILE "pwg-raster-samples-$RASTER_RESOLUTION/black-1/onepage-letter-black-1-$RASTER_RESOLUTION.pwg"

	STATUS successful-ok
	STATUS server-error-job-canceled
	STATUS server-error-busy REPEAT-MATCH REPEAT-LIMIT 30

	EXPECT job-uri OF-TYPE uri COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE "$IPP_URI_SCHEME"

	EXPECT job-id OF-TYPE integer COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE >0
	EXPECT job-id DEFINE-VALUE MEDIA_NEEDED_ID

	EXPECT job-state OF-TYPE unknown|enum COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE 3,4,5,6,7,8,9
	EXPECT job-state WITH-VALUE 7,8,9 DEFINE-MATCH PRINT_JOB_COMPLETED

	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag

	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
}
{
	SKIP-IF-DEFINED IPP_EVERYWHERE_SERVER
	SKIP-IF-NOT-DEFINED HAVE_SGRAY
	SKIP-IF-DEFINED HAVE_SRGB

	PAUSE "Remove media from printer until this test run is complete."

	NAME "I-20. media-needed (Print-Job onepage-letter.pwg)"
	OPERATION Print-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR name job-name "media-needed Test"
	ATTR boolean ipp-attribute-fidelity false
	ATTR name document-name "media-needed Document"
	ATTR keyword compression none
	ATTR mimeMediaType document-format "image/pwg-raster"

	GROUP job-attributes-tag
	ATTR keyword media "$DEFAULT_MEDIA"
	ATTR keyword print-color-mode "$DEFAULT_PRINT_COLOR_MODE"
	ATTR enum print-quality $DEFAULT_PRINT_QUALITY
	ATTR resolution printer-resolution $DEFAULT_PRINTER_RESOLUTION
	ATTR keyword sides "one-sided"

	FILE "pwg-raster-samples-$RASTER_RESOLUTION/sgray-8/onepage-letter-sgray-8-$RASTER_RESOLUTION.pwg"

	STATUS successful-ok
	STATUS server-error-job-canceled
	STATUS server-error-busy REPEAT-MATCH REPEAT-LIMIT 30

	EXPECT job-uri OF-TYPE uri COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE "$IPP_URI_SCHEME"

	EXPECT job-id OF-TYPE integer COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE >0
	EXPECT job-id DEFINE-VALUE MEDIA_NEEDED_ID

	EXPECT job-state OF-TYPE unknown|enum COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE 3,4,5,6,7,8,9
	EXPECT job-state WITH-VALUE 7,8,9 DEFINE-MATCH PRINT_JOB_COMPLETED

	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag

	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
}
{
	SKIP-IF-DEFINED IPP_EVERYWHERE_SERVER
	SKIP-IF-NOT-DEFINED HAVE_SRGB

	PAUSE "Remove media from printer until this test run is complete."

	NAME "I-20. media-needed (Print-Job onepage-letter.pwg)"
	OPERATION Print-Job
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR name job-name "media-needed Test"
	ATTR boolean ipp-attribute-fidelity false
	ATTR name document-name "media-needed Document"
	ATTR keyword compression none
	ATTR mimeMediaType document-format "image/pwg-raster"

	GROUP job-attributes-tag
	ATTR keyword media "$DEFAULT_MEDIA"
	ATTR keyword print-color-mode "$DEFAULT_PRINT_COLOR_MODE"
	ATTR enum print-quality $DEFAULT_PRINT_QUALITY
	ATTR resolution printer-resolution $DEFAULT_PRINTER_RESOLUTION
	ATTR keyword sides "one-sided"

	FILE "pwg-raster-samples-$RASTER_RESOLUTION/srgb-8/onepage-letter-srgb-8-$RASTER_RESOLUTION.pwg"

	STATUS successful-ok
	STATUS server-error-job-canceled
	STATUS server-error-busy REPEAT-MATCH REPEAT-LIMIT 30

	EXPECT job-uri OF-TYPE uri COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE "$IPP_URI_SCHEME"

	EXPECT job-id OF-TYPE integer COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE >0
	EXPECT job-id DEFINE-VALUE MEDIA_NEEDED_ID

	EXPECT job-state OF-TYPE unknown|enum COUNT 1 IN-GROUP job-attributes-tag WITH-VALUE 3,4,5,6,7,8,9
	EXPECT job-state WITH-VALUE 7,8,9 DEFINE-MATCH PRINT_JOB_COMPLETED

	EXPECT job-state-message OF-TYPE text IN-GROUP job-attributes-tag

	EXPECT job-state-reasons OF-TYPE keyword IN-GROUP job-attributes-tag
}

# Test 'media-needed' reason
{
	SKIP-IF-DEFINED IPP_EVERYWHERE_SERVER

	DELAY 5

	NAME "I-20.1 media-needed (Get-Printer-Attributes)"
	OPERATION Get-Printer-Attributes
	GROUP operation-attributes-tag
	ATTR charset attributes-charset utf-8
	ATTR naturalLanguage attributes-natural-language en
	ATTR uri printer-uri $uri
	ATTR name requesting-user-name $user
	ATTR keyword requested-attributes "printer-state-reasons"

	STATUS successful-ok

	EXPECT printer-state-reasons OF-TYPE keyword IN-GROUP printer-attributes-tag WITH-VALUE "/^media-needed/" REPEAT-NO-MATCH REPEAT-LIMIT 24

	## Issue #50: Relax Get-Printer-Attributes tests
	# EXPECT !printer-state
}
